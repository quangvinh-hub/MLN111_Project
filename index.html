<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Nation's Voice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
    <meta
      name="description"
      content="Interactive civics mini-simulation exploring roles, interests, and conflict escalation under a simple policy shock."
    />
    <meta name="color-scheme" content="light dark" />
  </head>
  <body>
    <div id="root"></div>
    <div
      id="diag"
      style="
        display: none;
        max-width: 1200px;
        margin: 20px auto;
        padding: 12px 16px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        color: #ffd;
        background: rgba(255, 255, 255, 0.06);
      "
    ></div>

    <!-- React via CDN (no build) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <!-- Babel for JSX in-browser; suitable for demo/static hosting -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
      (function () {
        function show(msg) {
          var el = document.getElementById("diag");
          if (!el) return;
          el.style.display = "block";
          el.textContent = msg;
        }
        if (!navigator.onLine) {
          show(
            "Offline detected. This page needs internet to load React from CDN. Please connect and refresh."
          );
        }
        if (!window.React || !window.ReactDOM || !window.Babel) {
          show(
            "CDN libraries failed to load. If you are online, try hard refresh (Ctrl+F5). If the issue persists, run a local server and open http://localhost instead of file://"
          );
        }
        window.addEventListener("error", function (e) {
          show("Error: " + e.message);
        });
      })();
    </script>

    <!-- App code (inlined for file:// usage) with bilingual support -->
    <script type="text/babel" data-presets="es2015,react">
      /* global React, ReactDOM */

      const STRINGS = {
        en: {
          title: "The Nation's Voice",
          tagline:
            "Explore interests and conflict through roles, case studies, and a quick simulation.",
          shockBadge: "Policy Shock: +15% Fuel Tax",
          play: "Play minigame",
          startSingle: "Start Single-Role",
          startAll: "Start All-Roles",
          modeLabel: "Mode",
          modeSingle: "Single-Role",
          modeAll: "All-Roles",
          readCases: "Read cases",
          ctaCases: "Explore Case Studies",
          ctaArticles: "Read Articles",
          selectRoleTitle: "Select Your Role",
          selectRoleDesc:
            "Choose a perspective to experience the policy shock.",
          theoryTitle: "Marx–Lenin: Class–Nation at a glance",
          theoryPoints: [
            "History is class struggle; state policy often reflects ruling-class interests.",
            "National interests can clash with class interests → social protest.",
            "Policy design must weigh stakeholders; negotiation can reduce conflict.",
          ],
          caseStudiesTitle: "Case Studies",
          caseStudiesDesc: "Tap to learn how similar tensions unfolded.",
          summaryTab: "Summary",
          deepTab: "Deep",
          close: "Close",
          conflict: "Conflict",
          govPopularity: "Government Popularity",
          newsFeed: "News Feed",
          simulationTitle: "Fuel Tax Shock — Mini Simulation",
          turnsOf: (t, m) =>
            `Turns ${t}/${m}. Pick one action per turn from your role.`,
          setStances: "Set stances for all roles, then advance the week.",
          advance: "Advance Turn",
          disagreement: "Disagreement Index",
          satisfaction: "Satisfaction",
          simPurpose:
            "Goal: see how role disagreements under a fuel-tax shock drive social conflict.",
          support: "Support",
          negotiate: "Negotiate",
          oppose: "Oppose",
          reset: "Reset",
          low: "Low",
          high: "High",
          simComplete: "Simulation complete.",
          simDiscuss:
            "Discuss: whose interests were prioritized? What trade-offs worked?",
          policyAnnounce:
            "Policy announced: +15% fuel tax to fund infrastructure & energy transition.",
          warn: "Warning: Escalation risk rising. Streets tense.",
          crisis:
            "Crisis: Confrontations erupt. Emergency measures considered.",
          outcome1: "Outcome: Negotiated settlement stabilizes society.",
          outcome2: "Outcome: Uneasy truce. Popularity hit lingers.",
          outcome3:
            "Outcome: Crisis forces retreat or crackdown. Long-term trust declines.",
          shock: "Shock event: viral incident escalates tensions (+30).",
          gov: "Government",
          workers: "Workers",
          students: "Students",
          business: "Big Business",
          roles: {
            government: {
              blurb: "Budget stability, climate goals, national image.",
              chips: ["Revenue", "Macro stability", "Energy transition"],
            },
            workers: {
              blurb: "Cost of living pressure, wages, transport costs.",
              chips: ["Living costs", "Wages", "Transport"],
            },
            students: {
              blurb: "Fairness, transparency, future outlook.",
              chips: ["Transparency", "Opportunity", "Voice"],
            },
            business: {
              blurb: "Profits, logistics, PR & lobbying.",
              chips: ["Profit", "Supply chain", "Lobbying"],
            },
          },
          cases: {
            usa: {
              title: "USA — 'We are the 99%' (2011)",
              summary:
                "Occupy highlighted post-2008 inequality. Leaderless but reshaped discourse on distribution.",
              deep: "Occupy Wall Street began at Zuccotti Park in 2011, reacting to financial power and inequality after the 2008 crisis. The movement, despite lacking formal leadership, pushed income distribution to the center of public debate and illustrated how class interests can clash with the majority population.",
              sources: "Al Jazeera",
            },
            france: {
              title: "France — Gilets Jaunes (2018–2019)",
              summary:
                "Sparked by fuel-tax hikes, broadened into cost-of-living revolt seen as against “policies for the rich.”",
              deep: "Originating online against a fuel-tax increase, the Yellow Vests quickly became a leaderless nationwide movement expressing rural and lower-middle frustrations. Government partially backtracked. It showed how “national interest” narratives (e.g., climate goals) can collide with everyday livelihoods.",
              sources: "Wikipedia",
            },
            indo: {
              title: "Indonesia — Student Protests (2019)",
              summary:
                "Protested law changes weakening the anti-graft body and other controversial articles, leading to mass rallies.",
              deep: "In 2019, proposed revisions that curbed the anti-corruption commission triggered large student-led demonstrations nationwide. Tension reflected a clash between state-order priorities and civic demands for accountability and rule of law.",
              sources: "Reuters",
            },
          },
          nav: {
            home: "Home",
            intro: "Introduction",
            cases: "Case Studies",
            sim: "Simulation",
            articles: "Articles",
            presentation: "Presentation",
            quiz: "Quiz",
          },
          presentationTitle:
            "Class vs Nation: When 'National Interest' Conflicts with Citizens",
          presentationDesc:
            "Exploring the contradiction between national interests and class interests through Marx-Lenin theory and real-world social movements.",
          conclusionTitle: "Conclusion",
          articlesTitle: "Articles & Illustrations",
          articlesDesc:
            "Short bilingual briefs with sources and illustrative images.",
          read: "Read source",
          introTitle: "How to Play — Policy Simulator",
          intro: [
            "Role: You play as the Government (Prime Minister/President), managing the country through public policies.",
            "Main Indicators: GDP, Unemployment, Gini (inequality), Legitimacy (government trust), Military Strength, Public Services (health, education, welfare).",
            "Social Groups: Workers, Middle Class, Capitalists/Owners, Youth/Students, Freelancers/Farmers.",
            "Turns: Each turn = 1 year. Player chooses one policy → system updates indicators and group satisfaction. Random events may occur.",
            "Social Reactions: If a group is dissatisfied → strikes/protests. Multiple dissatisfied groups → Legitimacy drops sharply, risk of losing power.",
            "Government Responses: Negotiate, Media Campaign , or Repress (each with costs and risks).",
            "Winning Conditions: Achieve scenario goals (e.g., keep Legitimacy > 60 for 10 years, reduce Gini to 0.35, or increase Military Strength to a target).",
            "Losing Conditions: Overthrown due to low Legitimacy or the country falls into total crisis.",
          ],
          newsSource: "Tuổi Trẻ",
          langBtn: "VI/EN",
          policySimulatorTitle: "Nation vs Class — Policy Simulator",
          policySimulatorDesc:
            "Manage the country as Government. Choose policies each turn and balance competing interests.",
          turn: "Turn",
          year: "Year",
          indicators: "National Indicators",
          socialGroups: "Social Groups",
          policies: "Policy Choices",
          events: "Event Log",
          gameResult: "Game Result",
          gdp: "GDP",
          unemployment: "Unemployment",
          gini: "Gini (Inequality)",
          legitimacy: "Legitimacy",
          military: "Military Strength",
          publicServices: "Public Services",
          workers: "Workers",
          middleClass: "Middle Class",
          capitalists: "Capitalists",
          youth: "Youth/Students",
          freelancers: "Freelancers/Farmers",
          satisfaction: "Satisfaction",
          low: "Low",
          high: "High",
          choosePolicy: "Choose Policy",
          advanceTurn: "Advance Turn",
          reset: "Reset",
          negotiate: "Negotiate",
          pr: "PR Campaign",
          repress: "Repress",
          randomEvent: "Random Event",
          crisis: "Economic Crisis",
          protest: "Mass Protest",
          scandal: "Government Scandal",
          win: "Victory!",
          lose: "Defeat!",
          winCondition: "You achieved the scenario goals!",
          loseCondition:
            "Your legitimacy collapsed or the country fell into crisis.",
          playAgain: "Play Again",
        },
        vi: {
          title: "Tiếng nói Quốc gia",
          tagline:
            "Khám phá lợi ích và xung đột qua vai trò, case-study và mô phỏng nhanh.",
          shockBadge: "Cú sốc chính sách: Tăng thuế xăng +15%",
          play: "Chơi minigame",
          startSingle: "Chơi 1 vai",
          startAll: "Điều khiển 4 vai",
          modeLabel: "Chế độ",
          modeSingle: "1 vai",
          modeAll: "4 vai",
          readCases: "Xem case-study",
          ctaCases: "Khám phá Case Study",
          ctaArticles: "Đọc Bài báo",
          selectRoleTitle: "Chọn vai của bạn",
          selectRoleDesc: "Chọn một góc nhìn để trải nghiệm cú sốc chính sách.",
          theoryTitle: "Mác–Lênin: Giai cấp–Dân tộc tóm lược",
          theoryPoints: [
            "Lịch sử là đấu tranh giai cấp; chính sách thường phản ánh lợi ích giai cấp cầm quyền.",
            "Lợi ích dân tộc có thể mâu thuẫn với lợi ích giai cấp → phản kháng xã hội.",
            "Thiết kế chính sách phải cân lợi ích các bên; đàm phán giúp giảm xung đột.",
          ],
          caseStudiesTitle: "Case Study",
          caseStudiesDesc: "Nhấn để xem các căng thẳng tương tự đã diễn ra.",
          summaryTab: "Tóm tắt",
          deepTab: "Phân tích",
          close: "Đóng",
          conflict: "Mức xung đột",
          govPopularity: "Độ tín nhiệm chính phủ",
          newsFeed: "Bản tin",
          simulationTitle: "Tăng thuế xăng — Mô phỏng nhanh",
          turnsOf: (t, m) =>
            `Lượt ${t}/${m}. Mỗi lượt chọn 1 hành động của vai bạn.`,
          setStances: "Chọn lập trường cho mọi nhóm, sau đó sang tuần mới.",
          advance: "Sang lượt",
          disagreement: "Chỉ số bất đồng",
          satisfaction: "Mức hài lòng",
          simPurpose:
            "Mục tiêu: xem bất đồng lập trường dưới cú sốc thuế xăng đẩy xung đột xã hội ra sao.",
          support: "Ủng hộ",
          negotiate: "Đàm phán",
          oppose: "Phản đối",
          reset: "Làm lại",
          low: "Thấp",
          high: "Cao",
          simComplete: "Kết thúc mô phỏng.",
          simDiscuss:
            "Thảo luận: lợi ích ai được ưu tiên? Đánh đổi nào hiệu quả?",
          policyAnnounce:
            "Chính phủ công bố: tăng thuế xăng +15% để tài trợ hạ tầng & chuyển dịch năng lượng.",
          warn: "Cảnh báo: Nguy cơ leo thang. Đường phố căng thẳng.",
          crisis:
            "Khủng hoảng: Đụng độ bùng phát. Cân nhắc biện pháp khẩn cấp.",
          outcome1: "Kết quả: Đàm phán thành công, xã hội ổn định.",
          outcome2: "Kết quả: Hòa hoãn mong manh. Tín nhiệm suy giảm.",
          outcome3:
            "Kết quả: Khủng hoảng buộc thoái lui hoặc trấn áp. Niềm tin dài hạn giảm.",
          shock: "Sự kiện sốc: vụ việc lan truyền làm căng thẳng tăng (+30).",
          gov: "Chính phủ",
          workers: "Công nhân",
          students: "Sinh viên",
          business: "Doanh nghiệp lớn",
          roles: {
            government: {
              blurb: "Ổn định ngân sách, mục tiêu khí hậu, hình ảnh quốc gia.",
              chips: [
                "Thu ngân sách",
                "Ổn định vĩ mô",
                "Chuyển dịch năng lượng",
              ],
            },
            workers: {
              blurb: "Áp lực chi phí sống, lương, chi phí đi lại.",
              chips: ["Chi phí sống", "Lương", "Vận chuyển"],
            },
            students: {
              blurb: "Công bằng, minh bạch, tương lai.",
              chips: ["Minh bạch", "Cơ hội", "Tiếng nói"],
            },
            business: {
              blurb: "Lợi nhuận, logistics, PR & vận động hành lang.",
              chips: ["Lợi nhuận", "Chuỗi cung ứng", "Vận động"],
            },
          },
          cases: {
            usa: {
              title: "Mỹ — 'We are the 99%' (2011)",
              summary:
                "Occupy làm nổi bật bất bình đẳng sau khủng hoảng 2008; không lãnh đạo nhưng đổi hướng thảo luận phân phối thu nhập.",
              deep: "Occupy Wall Street khởi phát ở Zuccotti Park (2011) nhằm phản ứng trước quyền lực tài chính và bất bình đẳng sau 2008. Dù không có lãnh đạo, phong trào đẩy vấn đề phân phối thu nhập lên trung tâm diễn ngôn công chúng, cho thấy khi lợi ích giai cấp va chạm lợi ích đa số, phản kháng có thể lan rộng.",
              sources: "Al Jazeera",
            },
            france: {
              title: "Pháp — Áo Vàng (2018–2019)",
              summary:
                "Khởi nguồn phản đối tăng thuế nhiên liệu, mở rộng thành phong trào về chi phí sống và chính sách bị xem là “của giới giàu”.",
              deep: "Xuất phát trực tuyến phản đối tăng thuế nhiên liệu, Áo Vàng nhanh chóng thành phong trào không lãnh đạo rõ ràng, phản ánh ức chế của cư dân nông thôn và tầng lớp trung-thấp. Chính phủ phải lùi một số biện pháp. Cho thấy “lợi ích quốc gia” (mục tiêu khí hậu) có thể xung đột sinh kế hằng ngày.",
              sources: "Wikipedia",
            },
            indo: {
              title: "Indonesia — Biểu tình sinh viên (2019)",
              summary:
                "Phản đối sửa luật làm suy yếu cơ quan chống tham nhũng và điều khoản gây tranh cãi — dẫn đến tuần hành lớn.",
              deep: "Năm 2019, đề xuất hạn chế cơ quan chống tham nhũng kích hoạt các cuộc tuần hành sinh viên trên toàn quốc. Căng thẳng phản ánh xung đột giữa ưu tiên trật tự nhà nước và đòi hỏi minh bạch, trách nhiệm.",
              sources: "Reuters",
            },
          },
          nav: {
            home: "Trang chủ",
            intro: "Giới thiệu",
            cases: "Case Study",
            sim: "Mô phỏng",
            articles: "Bài báo",
            presentation: "Thuyết trình",
            quiz: "Trắc nghiệm",
          },
          presentationTitle:
            "Lợi ích quốc gia vs Lợi ích giai cấp: Khi chính sách không đại diện cho mọi công dân",
          presentationDesc:
            "Khám phá mâu thuẫn giữa lợi ích quốc gia và lợi ích giai cấp qua lý thuyết Marx-Lenin và các phong trào xã hội thực tế.",
          conclusionTitle: "Kết luận",
          articlesTitle: "Bài báo & Hình minh hoạ",
          articlesDesc: "Tóm tắt song ngữ kèm nguồn và hình minh hoạ.",
          read: "Đọc nguồn",
          introTitle: "Cách chơi — Mô phỏng chính sách",
          intro: [
            "Vai trò: Người chơi là Chính phủ (Thủ tướng/Tổng thống), quản lý quốc gia qua chính sách công.",
            "Chỉ số chính: GDP, Thất nghiệp, Gini (bất bình đẳng), Legitimacy (uy tín), Military Strength (quốc phòng), Public Services (y tế, giáo dục, phúc lợi).",
            "Nhóm xã hội: Người lao động, Trung lưu, Giới chủ/Tư bản, Thanh niên/Sinh viên, Nghề tự do/Nông dân.",
            "Lượt chơi: Mỗi lượt = 1 năm. Người chơi chọn 1 chính sách → hệ thống cập nhật chỉ số và mức độ hài lòng. Có thể xuất hiện biến cố ngẫu nhiên.",
            "Phản ứng xã hội: Nếu nhóm bất mãn → đình công/biểu tình. Nhiều nhóm bất mãn → Uy tín giảm mạnh, nguy cơ mất quyền lực.",
            "Cách xử lý: Chính phủ có thể đàm phán, truyền thông, hoặc đàn áp (mỗi lựa chọn có chi phí/rủi ro).",
            "Điều kiện thắng: Đạt mục tiêu kịch bản (Uy tín > 60 trong 10 năm, giảm Gini, tăng sức mạnh quân sự…).",
            "Điều kiện thua: Bị lật đổ do uy tín quá thấp hoặc đất nước rơi vào khủng hoảng toàn diện.",
          ],
          newsSource: "Tuổi Trẻ",
          langBtn: "VI/EN",
          policySimulatorTitle: "Quốc gia vs Giai cấp — Mô phỏng Chính sách",
          policySimulatorDesc:
            "Quản lý đất nước với vai trò Chính phủ. Chọn chính sách mỗi lượt và cân bằng lợi ích cạnh tranh.",
          turn: "Lượt",
          year: "Năm",
          indicators: "Chỉ số Quốc gia",
          socialGroups: "Nhóm Xã hội",
          policies: "Lựa chọn Chính sách",
          events: "Nhật ký Sự kiện",
          gameResult: "Kết quả Game",
          gdp: "GDP",
          unemployment: "Thất nghiệp",
          gini: "Gini (Bất bình đẳng)",
          legitimacy: "Uy tín",
          military: "Sức mạnh Quân sự",
          publicServices: "Dịch vụ Công",
          workers: "Công nhân",
          middleClass: "Tầng lớp Trung lưu",
          capitalists: "Tư bản",
          youth: "Thanh niên/Sinh viên",
          freelancers: "Tự do/Nông dân",
          satisfaction: "Hài lòng",
          low: "Thấp",
          high: "Cao",
          choosePolicy: "Chọn Chính sách",
          advanceTurn: "Sang lượt",
          reset: "Làm lại",
          negotiate: "Đàm phán",
          pr: "Chiến dịch PR",
          repress: "Đàn áp",
          randomEvent: "Sự kiện Ngẫu nhiên",
          crisis: "Khủng hoảng Kinh tế",
          protest: "Biểu tình Quy mô lớn",
          scandal: "Bê bối Chính phủ",
          win: "Chiến thắng!",
          lose: "Thất bại!",
          winCondition: "Bạn đã đạt được mục tiêu kịch bản!",
          loseCondition:
            "Uy tín của bạn sụp đổ hoặc đất nước rơi vào khủng hoảng.",
          playAgain: "Chơi lại",
        },
      };

      // Quiz Questions Data
      const QUIZ_QUESTIONS = {
        vi: [
          {
            id: 1,
            question:
              "Theo Marx-Lenin, giai cấp được xác định dựa trên yếu tố nào chủ yếu?",
            options: [
              "Mức thu nhập và tài sản",
              "Quan hệ sở hữu đối với tư liệu sản xuất",
              "Trình độ học vấn và văn hóa",
              "Xuất thân gia đình và dòng họ",
            ],
            correct: 1,
            explanation:
              "Giai cấp được xác định chủ yếu dựa trên quan hệ sở hữu đối với tư liệu sản xuất, đây là cơ sở kinh tế quyết định địa vị giai cấp.",
          },
          {
            id: 2,
            question:
              "Đấu tranh giai cấp có vai trò gì trong lịch sử loài người?",
            options: [
              "Làm cản trở sự phát triển xã hội",
              "Là động lực trực tiếp thúc đẩy xã hội phát triển",
              "Chỉ có tác dụng trong xã hội tư bản chủ nghĩa",
              "Không có ảnh hưởng đến tiến trình lịch sử",
            ],
            correct: 1,
            explanation:
              "Đấu tranh giai cấp là động lực trực tiếp thúc đẩy sự phát triển của xã hội loài người qua các giai đoạn lịch sử.",
          },
          {
            id: 3,
            question:
              "Dân tộc được hình thành dựa trên những đặc trưng cơ bản nào?",
            options: [
              "Chỉ cần có ngôn ngữ chung",
              "Ngôn ngữ, lãnh thổ, đời sống kinh tế và tâm lý chung",
              "Chỉ cần có lãnh thổ chung",
              "Chỉ cần có tôn giáo chung",
            ],
            correct: 1,
            explanation:
              "Dân tộc được hình thành dựa trên 4 đặc trưng cơ bản: ngôn ngữ chung, lãnh thổ chung, đời sống kinh tế chung và tâm lý chung.",
          },
          {
            id: 4,
            question:
              "Mối quan hệ giữa giai cấp và dân tộc có tính chất như thế nào?",
            options: [
              "Luôn mâu thuẫn với nhau",
              "Luôn thống nhất với nhau",
              "Có thể thống nhất hoặc mâu thuẫn tùy hoàn cảnh lịch sử",
              "Không có mối quan hệ gì với nhau",
            ],
            correct: 2,
            explanation:
              "Mối quan hệ giữa giai cấp và dân tộc có thể thống nhất hoặc mâu thuẫn tùy thuộc vào hoàn cảnh lịch sử cụ thể.",
          },
          {
            id: 5,
            question:
              "Trong kháng chiến chống thực dân Pháp, mối quan hệ giai cấp-dân tộc ở Việt Nam như thế nào?",
            options: [
              "Các giai cấp đấu tranh với nhau",
              "Các giai cấp đoàn kết vì lợi ích dân tộc",
              "Chỉ có giai cấp công nhân tham gia",
              "Các giai cấp không quan tâm đến vấn đề dân tộc",
            ],
            correct: 1,
            explanation:
              "Trong kháng chiến, các giai cấp (công nhân, nông dân, trí thức) đã đoàn kết tạo nên sức mạnh dân tộc vĩ đại.",
          },
          {
            id: 6,
            question: "Theo tư tưởng Hồ Chí Minh, điều gì là quý nhất?",
            options: [
              "Tiền bạc và vàng bạc",
              "Độc lập tự do",
              "Quyền lực chính trị",
              "Kiến thức và học vấn",
            ],
            correct: 1,
            explanation:
              "Theo Hồ Chí Minh: 'Không có gì quý hơn độc lập tự do' - thể hiện sự kết hợp hài hòa giữa lợi ích giai cấp và dân tộc.",
          },
          {
            id: 7,
            question:
              "Trong thời đại toàn cầu hóa, vấn đề dân tộc gắn liền với điều gì?",
            options: [
              "Chỉ gắn với lợi ích kinh tế",
              "Hòa bình, hợp tác và hội nhập quốc tế",
              "Chỉ gắn với vấn đề văn hóa",
              "Tách biệt khỏi cộng đồng quốc tế",
            ],
            correct: 1,
            explanation:
              "Trong thời đại hiện nay, vấn đề dân tộc gắn liền với hòa bình, hợp tác và toàn cầu hóa.",
          },
          {
            id: 8,
            question: "Việt Nam thực hiện chính sách dân tộc như thế nào?",
            options: [
              "Chỉ quan tâm đến dân tộc Kinh",
              "Đại đoàn kết toàn dân tộc và phát triển vùng dân tộc thiểu số",
              "Tách biệt các dân tộc",
              "Chỉ phát triển kinh tế",
            ],
            correct: 1,
            explanation:
              "Việt Nam thực hiện chính sách đại đoàn kết toàn dân tộc, phát triển vùng dân tộc thiểu số và giữ gìn bản sắc văn hóa của 54 dân tộc.",
          },
          {
            id: 9,
            question:
              "Quan hệ giai cấp-dân tộc-nhân loại trong bối cảnh hiện nay cần được giải quyết như thế nào?",
            options: [
              "Chỉ quan tâm đến lợi ích giai cấp",
              "Chỉ quan tâm đến lợi ích dân tộc",
              "Một cách hài hòa và cân bằng",
              "Tách biệt từng yếu tố",
            ],
            correct: 2,
            explanation:
              "Quan hệ giai cấp-dân tộc-nhân loại có tính biện chứng phức tạp, cần được giải quyết một cách hài hòa và cân bằng.",
          },
          {
            id: 10,
            question:
              "Việt Nam tham gia hội nhập quốc tế thông qua những tổ chức nào?",
            options: [
              "Chỉ tham gia ASEAN",
              "ASEAN, WTO, CPTPP và các quan hệ đối tác chiến lược",
              "Chỉ tham gia WTO",
              "Không tham gia tổ chức quốc tế nào",
            ],
            correct: 1,
            explanation:
              "Việt Nam tham gia hội nhập quốc tế toàn diện qua ASEAN, WTO, CPTPP và mở rộng quan hệ đối tác chiến lược với nhiều nước.",
          },
        ],
        en: [
          {
            id: 1,
            question:
              "According to Marx-Lenin, social class is primarily determined by which factor?",
            options: [
              "Income level and property",
              "Relationship to ownership of means of production",
              "Education level and culture",
              "Family background and lineage",
            ],
            correct: 1,
            explanation:
              "Social class is primarily determined by the relationship to ownership of means of production, which is the economic foundation that determines class position.",
          },
          {
            id: 2,
            question: "What role does class struggle play in human history?",
            options: [
              "It hinders social development",
              "It is the direct driving force of social development",
              "It only matters in capitalist society",
              "It has no influence on historical progress",
            ],
            correct: 1,
            explanation:
              "Class struggle is the direct driving force that propels the development of human society through historical stages.",
          },
          {
            id: 3,
            question:
              "A nation is formed based on which basic characteristics?",
            options: [
              "Only needs common language",
              "Common language, territory, economic life and psychology",
              "Only needs common territory",
              "Only needs common religion",
            ],
            correct: 1,
            explanation:
              "A nation is formed based on 4 basic characteristics: common language, common territory, common economic life, and common psychology.",
          },
          {
            id: 4,
            question:
              "What is the nature of the relationship between class and nation?",
            options: [
              "Always contradictory",
              "Always unified",
              "Can be unified or contradictory depending on historical circumstances",
              "No relationship exists",
            ],
            correct: 2,
            explanation:
              "The relationship between class and nation can be unified or contradictory depending on specific historical circumstances.",
          },
          {
            id: 5,
            question:
              "During the resistance against French colonialism, how was the class-nation relationship in Vietnam?",
            options: [
              "Classes fought against each other",
              "Classes united for national interests",
              "Only the working class participated",
              "Classes ignored national issues",
            ],
            correct: 1,
            explanation:
              "During resistance wars, different classes (workers, peasants, intellectuals) united to create great national strength.",
          },
          {
            id: 6,
            question:
              "According to Ho Chi Minh's thought, what is most precious?",
            options: [
              "Money and gold",
              "Independence and freedom",
              "Political power",
              "Knowledge and education",
            ],
            correct: 1,
            explanation:
              "According to Ho Chi Minh: 'Nothing is more precious than independence and freedom' - representing harmonious combination of class and national interests.",
          },
          {
            id: 7,
            question:
              "In the era of globalization, national issues are linked to what?",
            options: [
              "Only economic interests",
              "Peace, cooperation and international integration",
              "Only cultural issues",
              "Separation from international community",
            ],
            correct: 1,
            explanation:
              "In today's era, national issues are linked to peace, cooperation and globalization.",
          },
          {
            id: 8,
            question: "How does Vietnam implement ethnic policies?",
            options: [
              "Only focuses on Kinh ethnic group",
              "Great national unity and ethnic minority development",
              "Separates ethnic groups",
              "Only focuses on economic development",
            ],
            correct: 1,
            explanation:
              "Vietnam implements great national unity policies, develops ethnic minority areas and preserves cultural identity of 54 ethnic groups.",
          },
          {
            id: 9,
            question:
              "How should class-nation-humanity relations be resolved in current context?",
            options: [
              "Only focus on class interests",
              "Only focus on national interests",
              "In a harmonious and balanced way",
              "Separate each element",
            ],
            correct: 2,
            explanation:
              "Class-nation-humanity relations have complex dialectical characteristics and need harmonious and balanced resolution.",
          },
          {
            id: 10,
            question:
              "Vietnam participates in international integration through which organizations?",
            options: [
              "Only ASEAN",
              "ASEAN, WTO, CPTPP and strategic partnerships",
              "Only WTO",
              "No international organizations",
            ],
            correct: 1,
            explanation:
              "Vietnam participates in comprehensive international integration through ASEAN, WTO, CPTPP and expanding strategic partnerships with many countries.",
          },
        ],
      };

      function getCases(lang) {
        const S = STRINGS[lang];
        return [
          {
            id: "usa-2011",
            title: S.cases.usa.title,
            summary: S.cases.usa.summary,
            deep: S.cases.usa.deep,
            sources: [S.cases.usa.sources],
          },
          {
            id: "france-2018",
            title: S.cases.france.title,
            summary: S.cases.france.summary,
            deep: S.cases.france.deep,
            sources: [S.cases.france.sources],
          },
          {
            id: "indo-2019",
            title: S.cases.indo.title,
            summary: S.cases.indo.summary,
            deep: S.cases.indo.deep,
            sources: [S.cases.indo.sources],
          },
        ];
      }

      const INITIAL_STATE = {
        turn: 1,
        maxTurns: 6,
        conflict: 20,
        governmentPopularity: 70,
        feed: [],
      };

      function clamp(n, min, max) {
        return Math.max(min, Math.min(max, n));
      }

      function ConflictMeter({ value }) {
        const pct = clamp(value, 0, 100);
        return (
          <div>
            <div className="meter" aria-label="Conflict meter">
              <span style={{ width: `${pct}%` }} />
            </div>
            <div className="meter-label">
              <span>Calm</span>
              <span>{pct}%</span>
              <span>Crisis</span>
            </div>
          </div>
        );
      }

      function Modal({ open, onClose, children }) {
        if (!open) return null;
        return (
          <div className="modal-backdrop" onClick={onClose}>
            <div className="modal" onClick={(e) => e.stopPropagation()}>
              {children}
            </div>
          </div>
        );
      }

      function NavBar({ lang, setLang, page, setPage }) {
        const S = STRINGS[lang];
        return (
          <div className="nav">
            <div className="nav-inner">
              <div className="brand">The Nation's Voice</div>
              <a
                className={page === "home" ? "active" : ""}
                onClick={() => setPage("home")}
              >
                {S.nav.home}
              </a>
              <a
                className={page === "intro" ? "active" : ""}
                onClick={() => setPage("intro")}
              >
                {S.nav.intro}
              </a>
              <a
                className={page === "cases" ? "active" : ""}
                onClick={() => setPage("cases")}
              >
                {S.nav.cases}
              </a>
              <a
                className={page === "sim" ? "active" : ""}
                onClick={() => setPage("sim")}
              >
                {S.nav.sim}
              </a>
              <a
                className={page === "articles" ? "active" : ""}
                onClick={() => setPage("articles")}
              >
                {S.nav.articles}
              </a>
              <a
                className={page === "presentation" ? "active" : ""}
                onClick={() => setPage("presentation")}
              >
                {S.nav.presentation}
              </a>
              <a
                className={page === "quiz" ? "active" : ""}
                onClick={() => setPage("quiz")}
              >
                {S.nav.quiz}
              </a>
              <div className="spacer"></div>
              <button
                className="btn"
                onClick={() => setLang(lang === "vi" ? "en" : "vi")}
              >
                {S.langBtn}
              </button>
            </div>
          </div>
        );
      }

      function CaseStudies({ lang }) {
        const CASES = React.useMemo(() => getCases(lang), [lang]);
        const S = STRINGS[lang];
        const [openId, setOpenId] = React.useState(null);
        const [tab, setTab] = React.useState("summary");
        const openCase = CASES.find((c) => c.id === openId);

        return (
          <>
            {CASES.map((cs, index) => (
              <div key={cs.id} className={`case-study-card case-${index + 1}`}>
                <div className="case-header">
                  <div className="case-number">
                    <span className="case-num">
                      {String(index + 1).padStart(2, "0")}
                    </span>
                  </div>
                  <div className="case-title-section">
                    <h3 className="case-title">{cs.title}</h3>
                    <div className="case-meta">
                      <span className="case-source">
                        Source: {cs.sources[0]}
                      </span>
                    </div>
                  </div>
                </div>

                <div className="case-content">
                  <p className="case-summary">{cs.summary}</p>
                </div>

                <div className="case-footer">
                  <button
                    className="case-read-btn"
                    onClick={() => {
                      setOpenId(cs.id);
                      setTab("summary");
                    }}
                  >
                    {lang === "vi" ? "Đọc chi tiết" : "Read More"}
                  </button>
                  <div className="case-tags">
                    <span className="case-tag">
                      {cs.id.includes("usa")
                        ? lang === "vi"
                          ? "Mỹ"
                          : "USA"
                        : cs.id.includes("france")
                        ? lang === "vi"
                          ? "Pháp"
                          : "France"
                        : cs.id.includes("indo")
                        ? "Indonesia"
                        : "Global"}
                    </span>
                    <span className="case-year">
                      {cs.id.includes("2011")
                        ? "2011"
                        : cs.id.includes("2018")
                        ? "2018-2019"
                        : "2019"}
                    </span>
                  </div>
                </div>
              </div>
            ))}

            <Modal open={!!openId} onClose={() => setOpenId(null)}>
              {openCase && (
                <>
                  <div className="modal-header">
                    <h2 className="modal-title">{openCase.title}</h2>
                    <div className="modal-meta">
                      <span className="modal-source">
                        Source: {openCase.sources.join(", ")}
                      </span>
                    </div>
                  </div>

                  <div className="modal-tabs">
                    <button
                      className={`modal-tab ${
                        tab === "summary" ? "active" : ""
                      }`}
                      onClick={() => setTab("summary")}
                    >
                      {S.summaryTab}
                    </button>
                    <button
                      className={`modal-tab ${tab === "deep" ? "active" : ""}`}
                      onClick={() => setTab("deep")}
                    >
                      {S.deepTab}
                    </button>
                  </div>

                  <div className="modal-content">
                    {tab === "summary" ? (
                      <div className="content-section">
                        <h4>{S.summaryTab}</h4>
                        <p className="content-text">{openCase.summary}</p>
                      </div>
                    ) : (
                      <div className="content-section">
                        <h4>{S.deepTab} Analysis</h4>
                        <p className="content-text">{openCase.deep}</p>
                      </div>
                    )}
                  </div>

                  <div className="modal-actions">
                    <button
                      className="btn btn-secondary"
                      onClick={() => setOpenId(null)}
                    >
                      {S.close}
                    </button>
                  </div>
                </>
              )}
            </Modal>
          </>
        );
      }

      // Policy Simulator Game State
      const POLICY_SIMULATOR_INITIAL = {
        turn: 1,
        maxTurns: 10,
        indicators: {
          gdp: 85,
          unemployment: 25,
          gini: 0.45,
          legitimacy: 70,
          military: 60,
          publicServices: 65,
        },
        socialGroups: {
          workers: 60,
          middleClass: 70,
          capitalists: 80,
          youth: 55,
          freelancers: 65,
        },
        selectedPolicy: null,
        events: [],
        gameEnded: false,
        gameWon: false,
        pendingResponse: null,
      };

      const POLICIES = {
        en: [
          {
            id: "tax_cut",
            name: "Tax Cut",
            description: "Reduce corporate taxes to boost business investment",
            effects: {
              gdp: 10,
              unemployment: -5,
              gini: 5,
              capitalists: 15,
              middleClass: 5,
              workers: -5,
            },
          },
          {
            id: "welfare_increase",
            name: "Welfare Increase",
            description: "Expand social safety nets and public services",
            effects: {
              gdp: -5,
              unemployment: 2,
              gini: -8,
              legitimacy: 10,
              publicServices: 15,
              workers: 12,
              middleClass: 8,
              freelancers: 10,
            },
          },
          {
            id: "military_buildup",
            name: "Military Buildup",
            description: "Increase defense spending and military capabilities",
            effects: {
              gdp: -3,
              military: 20,
              legitimacy: 5,
              capitalists: 8,
              workers: -3,
              youth: -8,
            },
          },
          {
            id: "education_reform",
            name: "Education Reform",
            description: "Invest in education and skills training programs",
            effects: {
              gdp: 5,
              unemployment: -8,
              publicServices: 12,
              youth: 15,
              workers: 8,
              middleClass: 5,
            },
          },
          {
            id: "infrastructure",
            name: "Infrastructure Investment",
            description: "Major public works and transportation projects",
            effects: {
              gdp: 15,
              unemployment: -10,
              legitimacy: 8,
              publicServices: 10,
              workers: 10,
              middleClass: 5,
            },
          },
          {
            id: "environmental",
            name: "Environmental Policy",
            description: "Green energy transition and environmental protection",
            effects: {
              gdp: -2,
              unemployment: 3,
              legitimacy: 12,
              capitalists: -5,
              youth: 18,
              freelancers: -3,
            },
          },
          {
            id: "fuel_tax",
            name: "Fuel Tax Increase",
            description: "Raise fuel taxes to fund infrastructure",
            effects: {
              gdp: 3,
              unemployment: 2,
              gini: 8,
              legitimacy: -15,
              publicServices: 8,
              workers: -25,
              middleClass: -15,
              freelancers: -20,
              capitalists: 5,
            },
          },
          {
            id: "pension_cut",
            name: "Pension Reform",
            description: "Cut public pensions to reduce budget deficit",
            effects: {
              gdp: 8,
              unemployment: 1,
              gini: 12,
              legitimacy: -20,
              publicServices: -5,
              workers: -30,
              middleClass: -10,
              freelancers: -15,
              capitalists: 10,
            },
          },
          {
            id: "austerity",
            name: "Austerity Measures",
            description: "Budget cuts to public services and social programs",
            effects: {
              gdp: 5,
              unemployment: 8,
              gini: 10,
              legitimacy: -25,
              publicServices: -20,
              workers: -35,
              middleClass: -20,
              freelancers: -25,
              capitalists: 8,
            },
          },
          {
            id: "minimum_wage",
            name: "Minimum Wage Increase",
            description: "Raise minimum wage to improve living standards",
            effects: {
              gdp: -2,
              unemployment: 3,
              gini: -5,
              legitimacy: 8,
              workers: 20,
              middleClass: 5,
              capitalists: -10,
              freelancers: 8,
            },
          },
          {
            id: "corporate_tax",
            name: "Corporate Tax Hike",
            description: "Increase corporate tax rates for revenue",
            effects: {
              gdp: -3,
              unemployment: 2,
              gini: -3,
              legitimacy: 5,
              publicServices: 8,
              capitalists: -15,
              middleClass: 3,
              workers: 5,
            },
          },
          {
            id: "healthcare_cut",
            name: "Healthcare Cuts",
            description: "Reduce public healthcare spending",
            effects: {
              gdp: 6,
              unemployment: 1,
              gini: 8,
              legitimacy: -18,
              publicServices: -15,
              workers: -20,
              middleClass: -15,
              freelancers: -18,
              capitalists: 8,
            },
          },
          {
            id: "education_cut",
            name: "Education Cuts",
            description: "Reduce public education funding",
            effects: {
              gdp: 4,
              unemployment: 2,
              gini: 6,
              legitimacy: -12,
              publicServices: -12,
              youth: -25,
              workers: -8,
              middleClass: -10,
              freelancers: -12,
            },
          },
          {
            id: "labor_reform",
            name: "Labor Market Reform",
            description: "Deregulate labor market for flexibility",
            effects: {
              gdp: 8,
              unemployment: -3,
              gini: 8,
              legitimacy: -8,
              workers: -15,
              middleClass: -5,
              capitalists: 18,
              youth: -10,
            },
          },
          {
            id: "wealth_tax",
            name: "Wealth Tax",
            description: "Tax on high net worth individuals",
            effects: {
              gdp: -1,
              unemployment: 1,
              gini: -12,
              legitimacy: 12,
              publicServices: 10,
              capitalists: -20,
              middleClass: 8,
              workers: 8,
            },
          },
          {
            id: "carbon_tax",
            name: "Carbon Tax",
            description: "Tax on carbon emissions",
            effects: {
              gdp: -2,
              unemployment: 2,
              gini: 3,
              legitimacy: 8,
              capitalists: -8,
              middleClass: -3,
              workers: -5,
              youth: 12,
              freelancers: -8,
            },
          },
          {
            id: "universal_income",
            name: "Universal Basic Income",
            description: "Provide basic income to all citizens",
            effects: {
              gdp: -8,
              unemployment: 5,
              gini: -15,
              legitimacy: 15,
              publicServices: 5,
              workers: 25,
              middleClass: 15,
              freelancers: 20,
              capitalists: -12,
            },
          },
          {
            id: "military_cut",
            name: "Defense Spending Cut",
            description: "Reduce military budget",
            effects: {
              gdp: 2,
              unemployment: 1,
              gini: 2,
              legitimacy: -5,
              military: -15,
              capitalists: -5,
              workers: 3,
              middleClass: 5,
              youth: 8,
            },
          },
        ],
        vi: [
          {
            id: "tax_cut",
            name: "Giảm Thuế",
            description: "Giảm thuế doanh nghiệp để thúc đẩy đầu tư kinh doanh",
            effects: {
              gdp: 10,
              unemployment: -5,
              gini: 5,
              capitalists: 15,
              middleClass: 5,
              workers: -5,
            },
          },
          {
            id: "welfare_increase",
            name: "Tăng Phúc lợi",
            description: "Mở rộng mạng lưới an sinh xã hội và dịch vụ công",
            effects: {
              gdp: -5,
              unemployment: 2,
              gini: -8,
              legitimacy: 10,
              publicServices: 15,
              workers: 12,
              middleClass: 8,
              freelancers: 10,
            },
          },
          {
            id: "military_buildup",
            name: "Tăng cường Quân sự",
            description: "Tăng chi tiêu quốc phòng và năng lực quân sự",
            effects: {
              gdp: -3,
              military: 20,
              legitimacy: 5,
              capitalists: 8,
              workers: -3,
              youth: -8,
            },
          },
          {
            id: "education_reform",
            name: "Cải cách Giáo dục",
            description: "Đầu tư vào giáo dục và chương trình đào tạo kỹ năng",
            effects: {
              gdp: 5,
              unemployment: -8,
              publicServices: 12,
              youth: 15,
              workers: 8,
              middleClass: 5,
            },
          },
          {
            id: "infrastructure",
            name: "Đầu tư Hạ tầng",
            description: "Các dự án công trình công cộng và giao thông lớn",
            effects: {
              gdp: 15,
              unemployment: -10,
              legitimacy: 8,
              publicServices: 10,
              workers: 10,
              middleClass: 5,
            },
          },
          {
            id: "environmental",
            name: "Chính sách Môi trường",
            description: "Chuyển đổi năng lượng xanh và bảo vệ môi trường",
            effects: {
              gdp: -2,
              unemployment: 3,
              legitimacy: 12,
              capitalists: -5,
              youth: 18,
              freelancers: -3,
            },
          },
          {
            id: "fuel_tax",
            name: "Tăng Thuế Xăng",
            description: "Tăng thuế xăng để tài trợ hạ tầng",
            effects: {
              gdp: 3,
              unemployment: 2,
              gini: 8,
              legitimacy: -15,
              publicServices: 8,
              workers: -25,
              middleClass: -15,
              freelancers: -20,
              capitalists: 5,
            },
          },
          {
            id: "pension_cut",
            name: "Cắt Giảm Lương Hưu",
            description: "Cắt giảm lương hưu công để giảm thâm hụt ngân sách",
            effects: {
              gdp: 8,
              unemployment: 1,
              gini: 12,
              legitimacy: -20,
              publicServices: -5,
              workers: -30,
              middleClass: -10,
              freelancers: -15,
              capitalists: 10,
            },
          },
          {
            id: "austerity",
            name: "Thắt Lưng Buộc Bụng",
            description:
              "Cắt giảm ngân sách dịch vụ công và chương trình xã hội",
            effects: {
              gdp: 5,
              unemployment: 8,
              gini: 10,
              legitimacy: -25,
              publicServices: -20,
              workers: -35,
              middleClass: -20,
              freelancers: -25,
              capitalists: 8,
            },
          },
          {
            id: "minimum_wage",
            name: "Tăng Lương Tối Thiểu",
            description: "Tăng lương tối thiểu để cải thiện mức sống",
            effects: {
              gdp: -2,
              unemployment: 3,
              gini: -5,
              legitimacy: 8,
              workers: 20,
              middleClass: 5,
              capitalists: -10,
              freelancers: 8,
            },
          },
          {
            id: "corporate_tax",
            name: "Tăng Thuế Doanh Nghiệp",
            description: "Tăng thuế suất doanh nghiệp để tăng thu ngân sách",
            effects: {
              gdp: -3,
              unemployment: 2,
              gini: -3,
              legitimacy: 5,
              publicServices: 8,
              capitalists: -15,
              middleClass: 3,
              workers: 5,
            },
          },
          {
            id: "healthcare_cut",
            name: "Cắt Giảm Y Tế",
            description: "Giảm chi tiêu y tế công",
            effects: {
              gdp: 6,
              unemployment: 1,
              gini: 8,
              legitimacy: -18,
              publicServices: -15,
              workers: -20,
              middleClass: -15,
              freelancers: -18,
              capitalists: 8,
            },
          },
          {
            id: "education_cut",
            name: "Cắt Giảm Giáo Dục",
            description: "Giảm ngân sách giáo dục công",
            effects: {
              gdp: 4,
              unemployment: 2,
              gini: 6,
              legitimacy: -12,
              publicServices: -12,
              youth: -25,
              workers: -8,
              middleClass: -10,
              freelancers: -12,
            },
          },
          {
            id: "labor_reform",
            name: "Cải Cách Thị Trường Lao Động",
            description:
              "Bãi bỏ quy định thị trường lao động để tăng linh hoạt",
            effects: {
              gdp: 8,
              unemployment: -3,
              gini: 8,
              legitimacy: -8,
              workers: -15,
              middleClass: -5,
              capitalists: 18,
              youth: -10,
            },
          },
          {
            id: "wealth_tax",
            name: "Thuế Tài Sản",
            description: "Đánh thuế người có tài sản cao",
            effects: {
              gdp: -1,
              unemployment: 1,
              gini: -12,
              legitimacy: 12,
              publicServices: 10,
              capitalists: -20,
              middleClass: 8,
              workers: 8,
            },
          },
          {
            id: "carbon_tax",
            name: "Thuế Carbon",
            description: "Đánh thuế phát thải carbon",
            effects: {
              gdp: -2,
              unemployment: 2,
              gini: 3,
              legitimacy: 8,
              capitalists: -8,
              middleClass: -3,
              workers: -5,
              youth: 12,
              freelancers: -8,
            },
          },
          {
            id: "universal_income",
            name: "Thu Nhập Cơ Bản Toàn Dân",
            description: "Cung cấp thu nhập cơ bản cho mọi công dân",
            effects: {
              gdp: -8,
              unemployment: 5,
              gini: -15,
              legitimacy: 15,
              publicServices: 5,
              workers: 25,
              middleClass: 15,
              freelancers: 20,
              capitalists: -12,
            },
          },
          {
            id: "military_cut",
            name: "Cắt Giảm Quốc Phòng",
            description: "Giảm ngân sách quân sự",
            effects: {
              gdp: 2,
              unemployment: 1,
              gini: 2,
              legitimacy: -5,
              military: -15,
              capitalists: -5,
              workers: 3,
              middleClass: 5,
              youth: 8,
            },
          },
        ],
      };

      const RANDOM_EVENTS = {
        en: [
          {
            id: "crisis",
            name: "Economic Crisis",
            description: "Global economic downturn affects the country",
            effects: {
              gdp: -15,
              unemployment: 10,
              legitimacy: -10,
              capitalists: -10,
              middleClass: -15,
              workers: -20,
            },
          },
          {
            id: "protest",
            name: "Mass Protest",
            description:
              "Large-scale demonstrations against government policies",
            effects: {
              legitimacy: -15,
              workers: -10,
              youth: -15,
              middleClass: -5,
            },
            requiresResponse: true,
          },
          {
            id: "scandal",
            name: "Government Scandal",
            description: "Corruption scandal shakes public confidence",
            effects: {
              legitimacy: -20,
              capitalists: -5,
              middleClass: -10,
              youth: -15,
            },
          },
          {
            id: "media_attack",
            name: "Media Criticism",
            description: "National media criticizes government decisions",
            effects: {
              legitimacy: -12,
              middleClass: -5,
              youth: -5,
            },
          },
        ],
        vi: [
          {
            id: "crisis",
            name: "Khủng hoảng Kinh tế",
            description: "Suy thoái kinh tế toàn cầu ảnh hưởng đến đất nước",
            effects: {
              gdp: -15,
              unemployment: 10,
              legitimacy: -10,
              capitalists: -10,
              middleClass: -15,
              workers: -20,
            },
          },
          {
            id: "protest",
            name: "Biểu tình Quy mô lớn",
            description:
              "Các cuộc biểu tình lớn chống lại chính sách của chính phủ",
            effects: {
              legitimacy: -15,
              workers: -10,
              youth: -15,
              middleClass: -5,
            },
            requiresResponse: true,
          },
          {
            id: "scandal",
            name: "Bê bối Chính phủ",
            description:
              "Bê bối tham nhũng làm rung chuyển lòng tin của công chúng",
            effects: {
              legitimacy: -20,
              capitalists: -5,
              middleClass: -10,
              youth: -15,
            },
          },
          {
            id: "media_attack",
            name: "Truyền thông chỉ trích",
            description: "Báo chí quốc gia chỉ trích quyết định của chính phủ",
            effects: {
              legitimacy: -12,
              middleClass: -5,
              youth: -5,
            },
          },
        ],
      };

      const GOVERNMENT_RESPONSES = {
        en: [
          {
            id: "negotiate",
            name: "Negotiate",
            description: "Engage in dialogue and compromise with protesters",
            effects: {
              legitimacy: 5,
              workers: 8,
              youth: 5,
              middleClass: 3,
              gdp: -2,
            },
            cost: 5,
          },
          {
            id: "pr",
            name: "PR Campaign",
            description: "Launch public relations campaign to improve image",
            effects: { legitimacy: 8, capitalists: 3, middleClass: 5, gdp: -3 },
            cost: 8,
          },
          {
            id: "repress",
            name: "Repress",
            description: "Use force to suppress protests (risky)",
            effects: {
              legitimacy: -10,
              workers: -15,
              youth: -20,
              capitalists: 5,
              military: 5,
            },
            cost: 3,
            risk: 0.3,
          },
        ],
        vi: [
          {
            id: "negotiate",
            name: "Đàm phán",
            description: "Tham gia đối thoại và thỏa hiệp với người biểu tình",
            effects: {
              legitimacy: 5,
              workers: 8,
              youth: 5,
              middleClass: 3,
              gdp: -2,
            },
            cost: 5,
          },
          {
            id: "pr",
            name: "Chiến dịch PR",
            description:
              "Phát động chiến dịch quan hệ công chúng để cải thiện hình ảnh",
            effects: { legitimacy: 8, capitalists: 3, middleClass: 5, gdp: -3 },
            cost: 8,
          },
          {
            id: "repress",
            name: "Đàn áp",
            description: "Sử dụng vũ lực để đàn áp biểu tình (rủi ro)",
            effects: {
              legitimacy: -10,
              workers: -15,
              youth: -20,
              capitalists: 5,
              military: 5,
            },
            cost: 3,
            risk: 0.3,
          },
        ],
      };

      function PolicySimulator({ lang }) {
        // Popup tóm tắt điểm lợi/hại sau khi chọn chính sách
        const [policySummary, setPolicySummary] = React.useState(null);
        // Social event popup state
        const [socialEvent, setSocialEvent] = React.useState(null);

        // Hiển thị điểm lợi/hại và phân tích mâu thuẫn khi chọn chính sách
        React.useEffect(() => {
          if (!gameState || !gameState.selectedPolicy) {
            setPolicySummary(null);
            return;
          }
          const policy = policies.find(
            (p) => p.id === gameState.selectedPolicy
          );
          if (!policy) return;
          const effects = policy.effects;
          const benefit = [],
            harm = [];
          Object.entries(effects).forEach(([k, v]) => {
            if (
              [
                "workers",
                "middleClass",
                "capitalists",
                "youth",
                "freelancers",
              ].includes(k)
            ) {
              if (v > 0) benefit.push({ group: k, value: v });
              if (v < 0) harm.push({ group: k, value: v });
            }
          });
          const analysis = getConflictAnalysis(policy);
          // Xác định nhóm được lợi nhất và nhóm bị thiệt nhất
          let mainGroup = analysis.benefitGroup;
          let lossGroup = analysis.lossGroup;
          let warning = "";
          if (analysis.conflictLevel === "High") {
            warning =
              lang === "vi"
                ? `Cảnh báo: Chính sách này chủ yếu phục vụ lợi ích nhóm "${
                    S[mainGroup] || mainGroup
                  }", gây thiệt hại lớn cho nhóm "${
                    S[lossGroup] || lossGroup
                  }". Mâu thuẫn lợi ích quốc gia–giai cấp rất cao!`
                : `Warning: This policy mainly benefits "${
                    S[mainGroup] || mainGroup
                  }", but greatly harms "${
                    S[lossGroup] || lossGroup
                  }". Very high class–nation conflict!`;
          } else if (analysis.conflictLevel === "Medium") {
            warning =
              lang === "vi"
                ? `Chính sách này có xu hướng ưu tiên lợi ích nhóm "${
                    S[mainGroup] || mainGroup
                  }" hơn các nhóm khác.`
                : `This policy tends to favor "${
                    S[mainGroup] || mainGroup
                  }" over other groups.`;
          } else {
            warning =
              lang === "vi"
                ? "Chính sách này khá cân bằng giữa các nhóm xã hội."
                : "This policy is relatively balanced among social groups.";
          }
          setPolicySummary({
            name: policy.name,
            benefit,
            harm,
            analysis,
            warning,
          });
          // Tự động ẩn sau 4 giây
          const timer = setTimeout(() => setPolicySummary(null), 4000);
          return () => clearTimeout(timer);
        }, [gameState && gameState.selectedPolicy, lang]);

        // Theo dõi mâu thuẫn xã hội để kích hoạt sự kiện đặc biệt
        React.useEffect(() => {
          console.log("PolicySimulator effect:", {
            selectedPolicy: gameState && gameState.selectedPolicy,
            gameState,
            policies,
          });
          if (!gameState || !gameState.selectedPolicy) {
            setPolicySummary(null);
            return;
          }
          const policy = policies.find(
            (p) => p.id === gameState.selectedPolicy
          );
          console.log("Selected policy object:", policy);
          if (!policy) return;
          const effects = policy.effects;
          const benefit = [],
            harm = [];
          Object.entries(effects).forEach(([k, v]) => {
            if (
              [
                "workers",
                "middleClass",
                "capitalists",
                "youth",
                "freelancers",
              ].includes(k)
            ) {
              if (v > 0) benefit.push({ group: k, value: v });
              if (v < 0) harm.push({ group: k, value: v });
            }
          });
          const analysis = getConflictAnalysis(policy);
          console.log("Policy analysis:", analysis);
          setPolicySummary({ name: policy.name, benefit, harm, analysis });
          // Tự động ẩn sau 4 giây
          const timer = setTimeout(() => setPolicySummary(null), 4000);
          return () => clearTimeout(timer);
        }, [gameState && gameState.selectedPolicy]);

        // Social event popup logic (separate effect)
        React.useEffect(() => {
          if (!gameState || !gameState.selectedPolicy) {
            setSocialEvent(null);
            return;
          }
          const policy = policies.find(
            (p) => p.id === gameState.selectedPolicy
          );
          const analysis = getConflictAnalysis(policy);
          let event = null;
          if (analysis && analysis.conflictLevel === "High") {
            if (analysis.lossGroup === "workers") {
              event =
                lang === "vi"
                  ? {
                      title: "Phong trào 99%",
                      desc: "Công nhân phản đối chính sách thiên vị giới chủ. Mâu thuẫn giai cấp bùng nổ!",
                    }
                  : {
                      title: "99% Movement",
                      desc: "Workers protest policies favoring capitalists. Class conflict erupts!",
                    };
            } else if (analysis.lossGroup === "middleClass") {
              event =
                lang === "vi"
                  ? {
                      title: "Áo Vàng",
                      desc: "Trung lưu và nông thôn biểu tình chống tăng thuế, phản đối lợi ích quốc gia không công bằng.",
                    }
                  : {
                      title: "Yellow Vests",
                      desc: "Middle class and rural protest tax hikes, challenge unfair 'national interest'.",
                    };
            } else if (analysis.lossGroup === "youth") {
              event =
                lang === "vi"
                  ? {
                      title: "Biểu tình sinh viên",
                      desc: "Thanh niên, sinh viên xuống đường phản đối chính sách thiếu minh bạch.",
                    }
                  : {
                      title: "Student Protests",
                      desc: "Youth and students protest lack of transparency in national policy.",
                    };
            }
          }
          if (event) setSocialEvent(event);
          else setSocialEvent(null);
        }, [gameState, gameState && gameState.selectedPolicy, lang]);
        // Tính toán mâu thuẫn lợi ích quốc gia–giai cấp cho chính sách được chọn
        function getConflictAnalysis(policy) {
          if (!policy) return null;
          // Nếu chính sách làm một nhóm tăng mạnh, nhóm khác giảm mạnh => mâu thuẫn cao
          const effects = policy.effects;
          let maxBenefit = -Infinity,
            maxLoss = Infinity,
            benefitGroup = "",
            lossGroup = "";
          Object.entries(effects).forEach(([k, v]) => {
            if (
              [
                "workers",
                "middleClass",
                "capitalists",
                "youth",
                "freelancers",
              ].includes(k)
            ) {
              if (v > maxBenefit) {
                maxBenefit = v;
                benefitGroup = k;
              }
              if (v < maxLoss) {
                maxLoss = v;
                lossGroup = k;
              }
            }
          });
          const conflictLevel =
            maxBenefit > 10 && maxLoss < -10
              ? "High"
              : maxBenefit > 5 && maxLoss < -5
              ? "Medium"
              : "Low";
          return {
            conflictLevel,
            benefitGroup,
            lossGroup,
            maxBenefit,
            maxLoss,
          };
        }
        const S = STRINGS[lang];
        const [gameState, setGameState] = React.useState(() => ({
          ...POLICY_SIMULATOR_INITIAL,
        }));
        const [showResult, setShowResult] = React.useState(false);

        const policies = POLICIES[lang];
        const randomEvents = RANDOM_EVENTS[lang];
        const responses = GOVERNMENT_RESPONSES[lang];

        // Update chatbot context when game state changes
        React.useEffect(() => {
          if (window.updateChatbotContext) {
            const currentContext = {
              currentTurn: gameState.turn,
              maxTurns: gameState.maxTurns,
              currentIndicators: gameState.indicators,
              currentSocialGroups: gameState.socialGroups,
              selectedPolicy: gameState.selectedPolicy,
              recentEvents: gameState.events?.slice(0, 3) || [],
              gameEnded: gameState.gameEnded,
              gameWon: gameState.gameWon,
              currentPolicies: policies.map((p) => ({
                id: p.id,
                name: p.name,
                description: p.description,
              })),
            };
            window.updateChatbotContext(currentContext);
          }
        }, [gameState, policies]);

        const applyPolicy = React.useCallback((policy) => {
          setGameState((prev) => {
            const newState = { ...prev };

            // Apply policy effects
            Object.entries(policy.effects).forEach(([key, value]) => {
              if (newState.indicators[key] !== undefined) {
                newState.indicators[key] = clamp(
                  newState.indicators[key] + value,
                  0,
                  100
                );
              }
              if (newState.socialGroups[key] !== undefined) {
                newState.socialGroups[key] = clamp(
                  newState.socialGroups[key] + value,
                  0,
                  100
                );
              }
            });

            // Add event log
            newState.events.unshift({
              id: Date.now(),
              type: "policy",
              title: policy.name,
              description: policy.description,
              turn: newState.turn,
              conflictAnalysis: getConflictAnalysis(policy),
            });

            newState.selectedPolicy = policy.id;
            return newState;
          });
        }, []);

        const applyResponse = React.useCallback(
          (response) => {
            setGameState((prev) => {
              const newState = { ...prev };

              // Apply response effects
              Object.entries(response.effects).forEach(([key, value]) => {
                if (newState.indicators[key] !== undefined) {
                  newState.indicators[key] = clamp(
                    newState.indicators[key] + value,
                    0,
                    100
                  );
                }
                if (newState.socialGroups[key] !== undefined) {
                  newState.socialGroups[key] = clamp(
                    newState.socialGroups[key] + value,
                    0,
                    100
                  );
                }
              });

              // Check for risk (repression can backfire)
              if (response.risk && Math.random() < response.risk) {
                newState.indicators.legitimacy = clamp(
                  newState.indicators.legitimacy - 15,
                  0,
                  100
                );
                newState.events.unshift({
                  id: Date.now(),
                  type: "response",
                  title:
                    lang === "vi"
                      ? "Đàn áp phản tác dụng"
                      : "Repression Backfires",
                  description:
                    lang === "vi"
                      ? "Việc đàn áp gây phản ứng dữ dội từ công chúng"
                      : "Repression causes public backlash",
                  turn: newState.turn,
                });
              }

              // Add event log
              newState.events.unshift({
                id: Date.now(),
                type: "response",
                title: response.name,
                description: response.description,
                turn: newState.turn,
              });

              newState.pendingResponse = null;
              return newState;
            });
          },
          [lang]
        );

        const advanceTurn = React.useCallback(() => {
          setGameState((prev) => {
            const newState = { ...prev };

            // Check for random events (20% chance)
            if (Math.random() < 0.2) {
              const event =
                randomEvents[Math.floor(Math.random() * randomEvents.length)];
              Object.entries(event.effects).forEach(([key, value]) => {
                if (newState.indicators[key] !== undefined) {
                  newState.indicators[key] = clamp(
                    newState.indicators[key] + value,
                    0,
                    100
                  );
                }
                if (newState.socialGroups[key] !== undefined) {
                  newState.socialGroups[key] = clamp(
                    newState.socialGroups[key] + value,
                    0,
                    100
                  );
                }
              });

              newState.events.unshift({
                id: Date.now(),
                type: "event",
                title: event.name,
                description: event.description,
                turn: newState.turn,
              });

              // If event requires response, set pending response
              if (event.requiresResponse) {
                newState.pendingResponse = event.id;
              }
            }

            // Check for protests/strikes
            const dissatisfiedGroups = Object.entries(
              newState.socialGroups
            ).filter(([_, satisfaction]) => satisfaction < 40);
            if (dissatisfiedGroups.length >= 2 && !newState.pendingResponse) {
              newState.indicators.legitimacy = clamp(
                newState.indicators.legitimacy - 10,
                0,
                100
              );
              newState.events.unshift({
                id: Date.now(),
                type: "protest",
                title:
                  lang === "vi"
                    ? "Biểu tình và Đình công"
                    : "Protests and Strikes",
                description:
                  lang === "vi"
                    ? "Nhiều nhóm xã hội bất mãn tổ chức phản kháng"
                    : "Multiple dissatisfied social groups organize resistance",
                turn: newState.turn,
              });
              newState.pendingResponse = "protest";
            }

            newState.turn += 1;
            newState.selectedPolicy = null;

            // Check win/lose conditions
            if (newState.turn > newState.maxTurns) {
              newState.gameEnded = true;
              newState.gameWon =
                newState.indicators.legitimacy >= 60 &&
                newState.indicators.gini <= 0.35;
              setShowResult(true);
            } else if (newState.indicators.legitimacy < 20) {
              newState.gameEnded = true;
              newState.gameWon = false;
              setShowResult(true);
            }

            return newState;
          });
        }, [lang, randomEvents]);

        const reset = React.useCallback(() => {
          setGameState({
            turn: 1,
            maxTurns: 10,
            indicators: {
              gdp: 85,
              unemployment: 25,
              gini: 0.45,
              legitimacy: 70,
              military: 60,
              publicServices: 65,
            },
            socialGroups: {
              workers: 60,
              middleClass: 70,
              capitalists: 80,
              youth: 55,
              freelancers: 65,
            },
            selectedPolicy: null,
            events: [],
            gameEnded: false,
            gameWon: false,
            pendingResponse: null,
          });
          setShowResult(false);
        }, []);

        if (showResult && gameState) {
          // Phân tích xã hội cuối game
          let socialComment = "";
          const dissatisfied = Object.entries(
            gameState.socialGroups || {}
          ).filter(([_, v]) => v < 40);
          if (dissatisfied.length >= 2) {
            socialComment =
              lang === "vi"
                ? "Nhiều nhóm xã hội bất mãn. Mâu thuẫn lợi ích quốc gia–giai cấp cao, nguy cơ phản kháng xã hội!"
                : "Multiple social groups dissatisfied. High class–nation conflict, risk of social protest!";
          } else if (gameState.gameWon) {
            socialComment =
              lang === "vi"
                ? "Bạn đã cân bằng tốt lợi ích quốc gia và các giai cấp. Xã hội ổn định!"
                : "You balanced national and class interests well. Society is stable!";
          }
          return (
            <div className="card" style={{ gridColumn: "span 12" }}>
              <h3>{S.gameResult}</h3>
              <div style={{ textAlign: "center", padding: "20px" }}>
                <h2
                  style={{
                    color: gameState.gameWon ? "var(--ok)" : "var(--danger)",
                    margin: "0 0 10px 0",
                  }}
                >
                  {gameState.gameWon ? S.win : S.lose}
                </h2>
                <p style={{ margin: "0 0 20px 0", color: "var(--muted)" }}>
                  {gameState.gameWon ? S.winCondition : S.loseCondition}
                </p>
                {socialComment && (
                  <div
                    style={{
                      color: "#d00",
                      fontWeight: "bold",
                      marginBottom: 12,
                    }}
                  >
                    {socialComment}
                  </div>
                )}
                <button className="btn primary" onClick={reset}>
                  {S.playAgain}
                </button>
              </div>
            </div>
          );
        }

        return (
          <div className="simulator-container">
            {/* Game Status Bar */}
            <div className="game-status-bar">
              <div className="status-info">
                <span className="status-item">
                  <span className="status-label">{S.turn}</span>
                  <span className="status-value">
                    {gameState.turn}/{gameState.maxTurns}
                  </span>
                </span>
                <span className="status-item">
                  <span className="status-label">{S.year}</span>
                  <span className="status-value">{2020 + gameState.turn}</span>
                </span>
              </div>
              <div className="game-controls">
                <button
                  className="btn btn-primary"
                  disabled={
                    gameState.gameEnded ||
                    !gameState.selectedPolicy ||
                    gameState.pendingResponse
                  }
                  onClick={advanceTurn}
                >
                  {S.advanceTurn}
                </button>
                <button className="btn btn-ghost" onClick={reset}>
                  {S.reset}
                </button>
                <button
                  className="btn btn-secondary"
                  onClick={() => {
                    document.getElementById("unified-chat-button").click();
                  }}
                >
                  🤖 Game Help
                </button>
              </div>
            </div>

            {/* Popup tóm tắt điểm lợi/hại và phân tích chính sách */}
            {policySummary && (
              <div className="modal-backdrop policy-impact-popup">
                <div className="policy-impact-card">
                  <div className="policy-impact-name">{policySummary.name}</div>
                  <div className="policy-impact-benefit-label">
                    {lang === "vi" ? "Nhóm được lợi:" : "Benefited groups:"}
                  </div>
                  <ul className="policy-impact-list">
                    {policySummary.benefit.length === 0 && (
                      <li className="policy-impact-none">
                        {lang === "vi" ? "Không có" : "None"}
                      </li>
                    )}
                    {policySummary.benefit.map((b) => (
                      <li key={b.group} className="policy-impact-benefit-item">
                        {S[b.group] || b.group}: +{b.value}
                      </li>
                    ))}
                  </ul>
                  <div className="policy-impact-harm-label">
                    {lang === "vi" ? "Nhóm bị thiệt hại:" : "Harmed groups:"}
                  </div>
                  <ul className="policy-impact-list">
                    {policySummary.harm.length === 0 && (
                      <li className="policy-impact-none">
                        {lang === "vi" ? "Không có" : "None"}
                      </li>
                    )}
                    {policySummary.harm.map((h) => (
                      <li key={h.group} className="policy-impact-harm-item">
                        {S[h.group] || h.group}: {h.value}
                      </li>
                    ))}
                  </ul>
                  <div
                    style={{ marginTop: 8, color: "#d00", fontWeight: "bold" }}
                  >
                    {policySummary.warning}
                  </div>
                </div>
              </div>
            )}
            {/* Main Game Grid */}
            <div className="simulator-grid">
              {/* Hiển thị phân tích mâu thuẫn lợi ích quốc gia–giai cấp khi chọn chính sách */}
              {gameState.selectedPolicy &&
                (() => {
                  const policy = policies.find(
                    (p) => p.id === gameState.selectedPolicy
                  );
                  const analysis = getConflictAnalysis(policy);
                  if (!analysis) return null;
                  let viLevel =
                    analysis.conflictLevel === "High"
                      ? "rất cao"
                      : analysis.conflictLevel === "Medium"
                      ? "trung bình"
                      : "thấp";
                  return (
                    <div
                      className="card"
                      style={{
                        gridColumn: "span 12",
                        background: "#ffeedd",
                        color: "#222",
                        marginBottom: 12,
                      }}
                    >
                      <strong>
                        {lang === "vi"
                          ? "Phân tích mâu thuẫn lợi ích:"
                          : "Class–Nation Conflict Analysis:"}
                      </strong>
                      <div>
                        {lang === "vi"
                          ? `Chính sách này có mức mâu thuẫn: ${viLevel}. Nhóm hưởng lợi: ${
                              S[analysis.benefitGroup]
                            }. Nhóm thiệt hại: ${S[analysis.lossGroup]}.`
                          : `This policy has ${
                              analysis.conflictLevel
                            } conflict. Benefited group: ${
                              S[analysis.benefitGroup]
                            }. Harmed group: ${S[analysis.lossGroup]}.`}
                      </div>
                    </div>
                  );
                })()}
              {/* National Indicators Dashboard */}
              <div className="sim-panel indicators-panel">
                <div className="panel-header">
                  <h3 className="panel-title">{S.indicators}</h3>
                  <div className="panel-accent indicators-accent"></div>
                </div>
                <div className="indicators-grid">
                  <div className="indicator-card gdp-card">
                    <div className="indicator-header">
                      <span className="indicator-label">{S.gdp}</span>
                      <span className="indicator-value">
                        {gameState.indicators.gdp}%
                      </span>
                    </div>
                    <div className="indicator-bar">
                      <div
                        className="indicator-fill gdp-fill"
                        style={{ width: `${gameState.indicators.gdp}%` }}
                      ></div>
                    </div>
                  </div>

                  <div className="indicator-card unemployment-card">
                    <div className="indicator-header">
                      <span className="indicator-label">{S.unemployment}</span>
                      <span className="indicator-value">
                        {gameState.indicators.unemployment}%
                      </span>
                    </div>
                    <div className="indicator-bar">
                      <div
                        className="indicator-fill unemployment-fill"
                        style={{
                          width: `${gameState.indicators.unemployment}%`,
                        }}
                      ></div>
                    </div>
                  </div>

                  <div className="indicator-card gini-card">
                    <div className="indicator-header">
                      <span className="indicator-label">{S.gini}</span>
                      <span className="indicator-value">
                        {gameState.indicators.gini.toFixed(2)}
                      </span>
                    </div>
                    <div className="indicator-bar">
                      <div
                        className="indicator-fill gini-fill"
                        style={{ width: `${gameState.indicators.gini * 100}%` }}
                      ></div>
                    </div>
                  </div>

                  <div className="indicator-card legitimacy-card">
                    <div className="indicator-header">
                      <span className="indicator-label">{S.legitimacy}</span>
                      <span className="indicator-value">
                        {gameState.indicators.legitimacy}%
                      </span>
                    </div>
                    <div className="indicator-bar">
                      <div
                        className="indicator-fill legitimacy-fill"
                        style={{ width: `${gameState.indicators.legitimacy}%` }}
                      ></div>
                    </div>
                  </div>

                  <div className="indicator-card military-card">
                    <div className="indicator-header">
                      <span className="indicator-label">{S.military}</span>
                      <span className="indicator-value">
                        {gameState.indicators.military}%
                      </span>
                    </div>
                    <div className="indicator-bar">
                      <div
                        className="indicator-fill military-fill"
                        style={{ width: `${gameState.indicators.military}%` }}
                      ></div>
                    </div>
                  </div>

                  <div className="indicator-card services-card">
                    <div className="indicator-header">
                      <span className="indicator-label">
                        {S.publicServices}
                      </span>
                      <span className="indicator-value">
                        {gameState.indicators.publicServices}%
                      </span>
                    </div>
                    <div className="indicator-bar">
                      <div
                        className="indicator-fill services-fill"
                        style={{
                          width: `${gameState.indicators.publicServices}%`,
                        }}
                      ></div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Social Groups Panel */}
              <div className="sim-panel groups-panel">
                <div className="panel-header">
                  <h3 className="panel-title">{S.socialGroups}</h3>
                  <div className="panel-accent groups-accent"></div>
                </div>
                <div className="groups-grid">
                  {Object.entries(gameState.socialGroups).map(
                    ([group, satisfaction]) => (
                      <div key={group} className="group-card">
                        <div className="group-header">
                          <span className="group-name">
                            {S[group] || group}
                          </span>
                          <span className="group-satisfaction">
                            {satisfaction}%
                          </span>
                        </div>
                        <div className="satisfaction-bar">
                          <div
                            className={`satisfaction-fill ${
                              satisfaction < 40 ? "dissatisfied" : "satisfied"
                            }`}
                            style={{ width: `${satisfaction}%` }}
                          ></div>
                        </div>
                        <div className="group-status">
                          {satisfaction < 30 && (
                            <span className="status-badge crisis">
                              {lang === "vi" ? "Khủng hoảng" : "Crisis"}
                            </span>
                          )}
                          {satisfaction >= 30 && satisfaction < 50 && (
                            <span className="status-badge warning">
                              {lang === "vi" ? "Bất mãn" : "Dissatisfied"}
                            </span>
                          )}
                          {satisfaction >= 70 && (
                            <span className="status-badge success">
                              {lang === "vi" ? "Hài lòng" : "Satisfied"}
                            </span>
                          )}
                        </div>
                      </div>
                    )
                  )}
                </div>
              </div>
              {/* Popup sự kiện xã hội khi mâu thuẫn lớn */}
              {socialEvent && (
                <div className="card social-event-popup">
                  <strong className="social-event-title">
                    {socialEvent.title}
                  </strong>
                  <div className="social-event-desc">{socialEvent.desc}</div>
                </div>
              )}

              {/* Policy Choices Panel */}
              <div className="sim-panel policies-panel">
                <div className="panel-header">
                  <h3 className="panel-title">{S.policies}</h3>
                  <div className="panel-accent policies-accent"></div>
                </div>
                <div className="policies-container">
                  <div className="policies-scroll">
                    {policies.map((policy) => {
                      const isSelected =
                        gameState && gameState.selectedPolicy === policy.id;
                      let analysis = null;
                      if (isSelected) {
                        analysis = getConflictAnalysis(policy);
                      }
                      return (
                        <div
                          key={policy.id}
                          className={`policy-card ${
                            isSelected ? "selected" : ""
                          }`}
                        >
                          <button
                            className="policy-btn"
                            disabled={
                              gameState &&
                              (gameState.gameEnded ||
                                gameState.selectedPolicy !== null)
                            }
                            onClick={() => applyPolicy(policy)}
                          >
                            <div className="policy-content">
                              <h4 className="policy-name">{policy.name}</h4>
                              <p className="policy-description">
                                {policy.description}
                              </p>
                              {isSelected && (
                                <>
                                  <div className="policy-selected">
                                    <span className="selected-badge">
                                      {lang === "vi" ? "Đã chọn" : "Selected"}
                                    </span>
                                  </div>
                                  {analysis &&
                                    analysis.conflictLevel === "High" && (
                                      <div
                                        style={{
                                          color: "#d00",
                                          fontWeight: "bold",
                                          marginTop: 8,
                                        }}
                                      >
                                        {lang === "vi"
                                          ? "Cảnh báo: Mâu thuẫn lợi ích quốc gia–giai cấp rất cao! Nguy cơ xuất hiện phong trào phản kháng xã hội."
                                          : "Warning: Very high class–nation conflict! Risk of major social protest movements."}
                                      </div>
                                    )}
                                </>
                              )}
                            </div>
                          </button>
                        </div>
                      );
                    })}
                  </div>

                  {/* Government Response Section */}
                  {gameState.pendingResponse && (
                    <div className="response-panel">
                      <div className="response-header">
                        <h4 className="response-title">
                          {lang === "vi"
                            ? "Cần Phản ứng của Chính phủ"
                            : "Government Response Required"}
                        </h4>
                        <p className="response-desc">
                          {lang === "vi"
                            ? "Chọn cách phản ứng với tình huống hiện tại:"
                            : "Choose how to respond to the current situation:"}
                        </p>
                      </div>
                      <div className="response-options">
                        {responses.map((response) => (
                          <button
                            key={response.id}
                            className="response-btn"
                            onClick={() => applyResponse(response)}
                          >
                            <div className="response-content">
                              <h5 className="response-name">{response.name}</h5>
                              <p className="response-description">
                                {response.description}
                              </p>
                              {response.risk && (
                                <div className="response-risk">
                                  {lang === "vi"
                                    ? `Rủi ro: ${Math.round(
                                        response.risk * 100
                                      )}%`
                                    : `Risk: ${Math.round(
                                        response.risk * 100
                                      )}%`}
                                </div>
                              )}
                            </div>
                          </button>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </div>

              {/* Events Timeline Panel */}
              <div className="sim-panel events-panel">
                <div className="panel-header">
                  <h3 className="panel-title">{S.events}</h3>
                  <div className="panel-accent events-accent"></div>
                </div>
                <div className="events-timeline">
                  {gameState.events.slice(0, 8).map((event) => (
                    <div key={event.id} className="event-card">
                      <div className="event-indicator">
                        <div className={`event-dot ${event.type}-dot`}></div>
                      </div>
                      <div className="event-content">
                        <h5 className="event-title">{event.title}</h5>
                        <p className="event-description">{event.description}</p>
                        <div className="event-meta">
                          <span className="event-turn">
                            {S.turn} {event.turn}
                          </span>
                          <span className="event-type-badge">
                            {event.type === "policy"
                              ? S.choosePolicy ||
                                (lang === "vi" ? "Chính sách" : "Policy")
                              : event.type === "event"
                              ? S.randomEvent ||
                                (lang === "vi" ? "Sự kiện" : "Event")
                              : event.type === "response"
                              ? lang === "vi"
                                ? "Phản ứng"
                                : "Response"
                              : event.type === "protest"
                              ? lang === "vi"
                                ? "Biểu tình"
                                : "Protest"
                              : ""}
                          </span>
                        </div>
                      </div>
                    </div>
                  ))}
                  {gameState.events.length === 0 && (
                    <div className="no-events">
                      <p>
                        {lang === "vi"
                          ? "Chưa có sự kiện nào..."
                          : "No events yet..."}
                      </p>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      function PresentationPage({ lang }) {
        const S = STRINGS[lang];

        return (
          <div className="presentation-page">
            {/* Hero Section */}
            <div className="page-hero">
              <div className="page-hero-content">
                <h1 className="page-title">{S.presentationTitle}</h1>
                <p className="page-description">{S.presentationDesc}</p>
                <div className="hero-highlight">
                  <span className="badge-text">
                    {lang === "vi" ? "Môn học: MLN111" : "Subject: MLN111"}
                  </span>
                </div>
              </div>
            </div>

            {/* Main Content */}
            <div className="presentation-content">
              {/* Mục lục */}
              <div className="content-section">
                <h2 className="section-title">
                  {lang === "vi" ? "Nội dung trình bày" : "Table of Contents"}
                </h2>
                <div className="table-of-contents">
                  <div className="toc-item">
                    <span className="toc-number">1</span>
                    <span className="toc-text">
                      {lang === "vi"
                        ? "Mở đầu – Đặt vấn đề"
                        : "Introduction – Problem Statement"}
                    </span>
                  </div>
                  <div className="toc-item">
                    <span className="toc-number">2</span>
                    <span className="toc-text">
                      {lang === "vi"
                        ? "Lý thuyết Marx-Lenin về giai cấp và dân tộc"
                        : "Marx-Lenin Theory on Class and Nation"}
                    </span>
                  </div>
                  <div className="toc-item">
                    <span className="toc-number">3</span>
                    <span className="toc-text">
                      {lang === "vi"
                        ? "Phân tích các phong trào xã hội"
                        : "Analysis of Social Movements"}
                    </span>
                  </div>
                  <div className="toc-item">
                    <span className="toc-number">4</span>
                    <span className="toc-text">
                      {lang === "vi" ? "Kết luận" : "Conclusion"}
                    </span>
                  </div>
                </div>
              </div>

              {/* Section 1: Mở đầu – Đặt vấn đề */}
              <div className="content-section">
                <h2 className="section-title">
                  {lang === "vi"
                    ? "1. Mở đầu – Đặt vấn đề"
                    : "1. Introduction – Problem Statement"}
                </h2>

                <div className="story-timeline">
                  <div className="story-chapter">
                    <div className="chapter-marker">📚</div>
                    <div className="chapter-content">
                      <h3 className="subsection-title">
                        {lang === "vi"
                          ? "Hiện tượng thực tiễn"
                          : "Real-world Phenomena"}
                      </h3>
                      <p className="narrative-text">
                        {lang === "vi"
                          ? "Khi một chính phủ ban hành chính sách lớn như tăng thuế, cải cách hưu trí, hay mở rộng ngân sách quốc phòng, họ thường tuyên bố rằng đó là 'vì lợi ích quốc gia'. Nhưng trên thực tế, không phải mọi công dân đều đồng thuận."
                          : "When a government implements major policies like tax increases, pension reform, or expanding defense budget, they often claim it's 'for national interest'. But in reality, not all citizens agree."}
                      </p>
                    </div>
                  </div>

                  <div className="story-chapter">
                    <div className="chapter-marker">🌍</div>
                    <div className="chapter-content">
                      <h3 className="subsection-title">
                        {lang === "vi"
                          ? "Những câu chuyện từ thế giới"
                          : "Stories from Around the World"}
                      </h3>

                      <div className="example-showcase">
                        {/* Occupy Wall Street */}
                        <div className="example-card">
                          <div className="example-title">
                            {lang === "vi"
                              ? "🇺🇸 Phong trào 'Occupy Wall Street' ở Mỹ (2011)"
                              : "🇺🇸 Occupy Wall Street Movement in USA (2011)"}
                          </div>
                          <div className="example-details">
                            <p>
                              <strong>
                                {lang === "vi" ? "Khẩu hiệu:" : "Slogan:"}
                              </strong>{" "}
                              {lang === "vi"
                                ? "'Chúng tôi là 99%' phản đối việc chính sách tài chính và thuế chỉ ưu tiên cho nhóm 1% siêu giàu"
                                : "'We are the 99%' opposing financial and tax policies that only favor the super-rich 1%"}
                            </p>
                            <p>
                              <strong>
                                {lang === "vi" ? "Bối cảnh:" : "Context:"}
                              </strong>{" "}
                              {lang === "vi"
                                ? "Sau khủng hoảng 2008, chính phủ cứu trợ các ngân hàng lớn nhưng người dân phải gánh chịu hậu quả"
                                : "After the 2008 crisis, government bailouts for big banks while citizens bear the consequences"}
                            </p>
                          </div>
                        </div>

                        {/* Yellow Vests */}
                        <div className="example-card">
                          <div className="example-title">
                            {lang === "vi"
                              ? "🇫🇷 Phong trào 'Áo Vàng' ở Pháp (2018–2019)"
                              : "🇫🇷 Yellow Vests Movement in France (2018–2019)"}
                          </div>
                          <div className="example-details">
                            <p>
                              <strong>
                                {lang === "vi" ? "Nguyên nhân:" : "Cause:"}
                              </strong>{" "}
                              {lang === "vi"
                                ? "Chính phủ tăng thuế nhiên liệu với lý do bảo vệ môi trường, nhưng làm chi phí sinh hoạt của tầng lớp lao động và trung lưu tăng mạnh"
                                : "Government increased fuel taxes for environmental protection, but raised living costs for workers and middle class"}
                            </p>
                            <p>
                              <strong>
                                {lang === "vi" ? "Hậu quả:" : "Consequence:"}
                              </strong>{" "}
                              {lang === "vi"
                                ? "Phong trào lan rộng toàn quốc, chính phủ phải rút lại một số biện pháp"
                                : "Movement spread nationwide, government had to withdraw some measures"}
                            </p>
                          </div>
                        </div>

                        {/* Indonesia */}
                        <div className="example-card">
                          <div className="example-title">
                            {lang === "vi"
                              ? "🇮🇩 Indonesia (2020, 2023)"
                              : "🇮🇩 Indonesia (2020, 2023)"}
                          </div>
                          <div className="example-details">
                            <p>
                              <strong>
                                {lang === "vi" ? "Sự kiện:" : "Event:"}
                              </strong>{" "}
                              {lang === "vi"
                                ? "Hàng chục nghìn sinh viên và công nhân xuống đường phản đối cải cách luật lao động và lương hưu"
                                : "Tens of thousands of students and workers protested labor law and pension reforms"}
                            </p>
                            <p>
                              <strong>
                                {lang === "vi" ? "Lý do:" : "Reason:"}
                              </strong>{" "}
                              {lang === "vi"
                                ? "Cho rằng cải cách có lợi cho doanh nghiệp, bất lợi cho người lao động"
                                : "Believed reforms favored businesses over workers"}
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="story-chapter">
                    <div className="chapter-marker">❓</div>
                    <div className="chapter-content">
                      <h3 className="subsection-title">
                        {lang === "vi"
                          ? "Câu hỏi kiến tạo"
                          : "Constructive Question"}
                      </h3>
                      <div className="conclusion-highlight">
                        <div className="conclusion-title">
                          {lang === "vi"
                            ? "Liệu 'lợi ích quốc gia' có thực sự là lợi ích của mọi công dân hay không?"
                            : "Do 'national interests' truly represent the interests of all citizens?"}
                        </div>
                        <div className="conclusion-text">
                          {lang === "vi"
                            ? "Để trả lời câu hỏi này, chúng ta cần vận dụng lý thuyết Marx-Lenin về mối quan hệ giữa giai cấp và dân tộc."
                            : "To answer this question, we need to apply Marx-Lenin theory on the relationship between class and nation."}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Section 2: Lý thuyết Marx-Lenin về giai cấp và dân tộc */}
              <div className="content-section">
                <h2 className="section-title">
                  {lang === "vi"
                    ? "2. Lý thuyết Marx-Lenin về giai cấp và dân tộc"
                    : "2. Marx-Lenin Theory on Class and Nation"}
                </h2>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "2.1 Khái niệm giai cấp"
                      : "2.1 Concept of Class"}
                  </h3>
                  <div className="content-box">
                    <p className="definition">
                      {lang === "vi"
                        ? "Giai cấp là những tập đoàn người to lớn, khác nhau về địa vị trong một hệ thống sản xuất xã hội nhất định."
                        : "Classes are large groups of people who differ in their position within a specific social production system."}
                    </p>
                    <div className="key-points">
                      <div className="key-point">
                        <span className="point-icon">🏭</span>
                        <span>
                          {lang === "vi"
                            ? "Quan hệ sở hữu tư liệu sản xuất"
                            : "Relations of ownership of means of production"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-icon">⚙️</span>
                        <span>
                          {lang === "vi"
                            ? "Vai trò trong tổ chức lao động"
                            : "Role in labor organization"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-icon">💰</span>
                        <span>
                          {lang === "vi"
                            ? "Cách thức hưởng thụ sản phẩm"
                            : "Methods of product distribution"}
                        </span>
                      </div>
                    </div>
                    <div className="example-box">
                      <h4>{lang === "vi" ? "📖 Ví dụ:" : "📖 Examples:"}</h4>
                      <p>
                        {lang === "vi"
                          ? "Xã hội phong kiến có địa chủ – nông dân, xã hội tư bản có tư sản – vô sản"
                          : "Feudal society has landlords – peasants, capitalist society has bourgeoisie – proletariat"}
                      </p>
                    </div>
                  </div>
                </div>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "2.2 Lý thuyết về dân tộc"
                      : "2.2 Theory of Nation"}
                  </h3>
                  <div className="content-box">
                    <p className="definition">
                      {lang === "vi"
                        ? "Lenin định nghĩa dân tộc như một cộng đồng người ổn định, được hình thành trong lịch sử, có chung ngôn ngữ, lãnh thổ, đời sống kinh tế và tâm lý, biểu hiện trong nền văn hóa chung."
                        : "Lenin defined nation as a stable historical community of people with common language, territory, economic life, and psychology manifested in common culture."}
                    </p>
                    <div className="key-points">
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Yếu tố khách quan:"
                              : "Objective Elements:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Lãnh thổ, ngôn ngữ, kinh tế chung"
                            : "Territory, language, common economy"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Yếu tố chủ quan:"
                              : "Subjective Elements:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Tâm lý, văn hóa, ý thức dân tộc"
                            : "Psychology, culture, national consciousness"}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "2.3 Nhà nước và giai cấp"
                      : "2.3 State and Class"}
                  </h3>
                  <div className="content-box">
                    <p className="definition">
                      {lang === "vi"
                        ? "Theo Marx-Lenin, nhà nước ra đời từ mâu thuẫn giai cấp, là công cụ của giai cấp thống trị để duy trì trật tự có lợi cho họ. Do vậy, cái gọi là 'quốc gia' không trung lập, mà thường phản ánh lợi ích của giai cấp cầm quyền."
                        : "According to Marx-Lenin, the state emerged from class contradictions, serving as a tool of the ruling class to maintain order beneficial to them. Therefore, what is called 'nation' is not neutral, but often reflects the interests of the ruling class."}
                    </p>
                    <div className="key-points">
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi" ? "Bản chất:" : "Nature:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Nhà nước là sản phẩm của mâu thuẫn giai cấp không thể hòa giải"
                            : "State is a product of irreconcilable class contradictions"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi" ? "Chức năng:" : "Function:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Công cụ của giai cấp thống trị để áp chế giai cấp bị trị"
                            : "Tool of ruling class to oppress the ruled class"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi" ? "Kết luận:" : "Conclusion:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "'Lợi ích quốc gia' thường phản ánh lợi ích giai cấp cầm quyền"
                            : "'National interests' often reflect ruling class interests"}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "2.4 Quan hệ giữa dân tộc và giai cấp"
                      : "2.4 Relationship Between Nation and Class"}
                  </h3>
                  <div className="content-box">
                    <p className="definition">
                      {lang === "vi"
                        ? "Mối quan hệ giữa lợi ích dân tộc và lợi ích giai cấp có thể thống nhất hoặc mâu thuẫn tùy thuộc vào hoàn cảnh lịch sử cụ thể."
                        : "The relationship between national interests and class interests can be unified or contradictory depending on specific historical circumstances."}
                    </p>

                    <div
                      className="example-box"
                      style={{ marginBottom: "1.5rem" }}
                    >
                      <h4>{lang === "vi" ? "Sự thống nhất" : "Unity"}</h4>
                      <div className="key-points">
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Khi nào:" : "When:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Lợi ích của giai cấp cầm quyền trùng hợp với lợi ích dân tộc"
                              : "When ruling class interests align with national interests"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Ví dụ:" : "Example:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Trong kháng chiến chống Pháp, Mỹ ở Việt Nam - mục tiêu giải phóng dân tộc là lợi ích chung của mọi tầng lớp nhân dân"
                              : "In Vietnam's resistance against France and US - national liberation goal was common interest of all social strata"}
                          </span>
                        </div>
                      </div>
                    </div>

                    <div className="example-box">
                      <h4>
                        {lang === "vi" ? "Sự mâu thuẫn" : "Contradiction"}
                      </h4>
                      <div className="key-points">
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Khi nào:" : "When:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Giai cấp cầm quyền nhân danh 'lợi ích quốc gia' để che giấu lợi ích riêng"
                              : "Ruling class uses 'national interests' to disguise private interests"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Ví dụ:" : "Example:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Trong xã hội tư bản - nhiều chính sách chủ yếu phục vụ tư bản tài chính và tập đoàn lớn"
                              : "In capitalist society - many policies mainly serve financial capital and large corporations"}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Section 3: Phân tích thực tiễn */}
              <div className="content-section">
                <h2 className="section-title">
                  {lang === "vi"
                    ? "3. Phân tích thực tiễn"
                    : "3. Practical Analysis"}
                </h2>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "3.1 Khi lợi ích giai cấp và dân tộc thống nhất"
                      : "3.1 When Class and National Interests Unite"}
                  </h3>
                  <div className="content-box">
                    <div className="example-box">
                      <h4>
                        {lang === "vi"
                          ? "Việt Nam trong kháng chiến"
                          : "Vietnam in Resistance Wars"}
                      </h4>
                      <div className="key-points">
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Bối cảnh:" : "Context:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Lợi ích giành độc lập dân tộc là lợi ích chung, vì mọi giai cấp đều chịu áp bức từ ngoại bang"
                              : "National independence was common interest as all classes suffered foreign oppression"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Kết quả:" : "Result:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Sự thống nhất này tạo nên sức mạnh đoàn kết toàn dân tộc"
                              : "This unity created great national solidarity strength"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Ý nghĩa:" : "Significance:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Chứng minh rằng khi lợi ích giai cấp và dân tộc trùng hợp, sức mạnh tập thể được phát huy tối đa"
                              : "Proves that when class and national interests align, collective strength is maximized"}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "3.2 Khi lợi ích giai cấp và dân tộc mâu thuẫn"
                      : "3.2 When Class and National Interests Conflict"}
                  </h3>
                  <div className="content-box">
                    {/* Mỹ 2011 */}
                    <div
                      className="example-box"
                      style={{ marginBottom: "1.5rem" }}
                    >
                      <h4>
                        {lang === "vi"
                          ? "Mỹ (2011): Phong trào Occupy Wall Street"
                          : "USA (2011): Occupy Wall Street Movement"}
                      </h4>
                      <div className="key-points">
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Nguyên nhân:" : "Cause:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Bùng nổ sau khủng hoảng tài chính 2008. Chính phủ chi hàng nghìn tỷ USD cứu ngân hàng và tập đoàn lớn, trong khi hàng triệu người lao động mất việc, mất nhà"
                              : "Erupted after 2008 financial crisis. Government spent trillions to bail out banks and corporations while millions of workers lost jobs and homes"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Khẩu hiệu:" : "Slogan:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "'We are the 99%' tố cáo sự bất công khi 1% dân số nắm giữ hơn 40% tài sản quốc gia"
                              : "'We are the 99%' exposed injustice where 1% of population holds over 40% of national wealth"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Ý nghĩa:" : "Significance:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Chứng minh 'lợi ích quốc gia' chỉ là cái cớ để bảo vệ lợi ích giai cấp tư bản tài chính"
                              : "Proved 'national interests' was just excuse to protect financial capitalist class interests"}
                          </span>
                        </div>
                      </div>
                    </div>

                    {/* Pháp 2018 */}
                    <div
                      className="example-box"
                      style={{ marginBottom: "1.5rem" }}
                    >
                      <h4>
                        {lang === "vi"
                          ? "Pháp (2018): Phong trào Áo Vàng"
                          : "France (2018): Yellow Vests Movement"}
                      </h4>
                      <div className="key-points">
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Nguyên nhân:" : "Cause:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Chính phủ Macron tăng thuế xăng dầu với lý do 'bảo vệ môi trường' và 'ổn định kinh tế quốc gia'"
                              : "Macron government increased fuel taxes for 'environmental protection' and 'national economic stability'"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Thực tế:" : "Reality:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Chi phí này đè nặng lên người lao động, đặc biệt ở vùng nông thôn, trong khi doanh nghiệp và người giàu được ưu đãi"
                              : "This cost burdened workers, especially in rural areas, while businesses and wealthy got benefits"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Phản ứng:" : "Response:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Hàng trăm nghìn người mặc áo vàng xuống đường phản đối chính sách thiên vị"
                              : "Hundreds of thousands in yellow vests protested biased policies"}
                          </span>
                        </div>
                      </div>
                    </div>

                    {/* Indonesia */}
                    <div className="example-box">
                      <h4>
                        {lang === "vi"
                          ? "Indonesia (2020, 2023): Biểu tình sinh viên và công nhân"
                          : "Indonesia (2020, 2023): Student and Worker Protests"}
                      </h4>
                      <div className="key-points">
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Chính sách:" : "Policy:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Luật Omnibus Law và cải cách hưu trí được chính phủ nói là 'cải thiện nền kinh tế quốc gia'"
                              : "Omnibus Law and pension reform claimed by government to 'improve national economy'"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Thực chất:" : "Reality:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Luật cho phép doanh nghiệp dễ dàng sa thải công nhân, giảm quyền lợi bảo hiểm xã hội"
                              : "Law allows businesses to easily fire workers, reduce social insurance benefits"}
                          </span>
                        </div>
                        <div className="key-point">
                          <span className="point-text">
                            <strong>
                              {lang === "vi" ? "Kết quả:" : "Result:"}
                            </strong>{" "}
                            {lang === "vi"
                              ? "Hàng loạt cuộc biểu tình nổ ra ở Jakarta và nhiều thành phố lớn"
                              : "Series of protests erupted in Jakarta and major cities"}
                          </span>
                        </div>
                      </div>
                    </div>

                    <div
                      style={{
                        background:
                          "linear-gradient(135deg, var(--accent-light), rgba(255, 215, 0, 0.1))",
                        padding: "1.5rem",
                        borderRadius: "var(--radius-lg)",
                        border: "2px solid var(--accent)",
                        marginTop: "1.5rem",
                      }}
                    >
                      <p
                        style={{
                          fontSize: "1.1rem",
                          fontWeight: "600",
                          color: "var(--accent-dark)",
                          margin: 0,
                          textAlign: "center",
                        }}
                      >
                        {lang === "vi"
                          ? "💡 Nhận xét chung: Những ví dụ trên chứng minh rằng 'lợi ích quốc gia' thường bị gắn nhãn để hợp thức hóa lợi ích của giai cấp thống trị. Khi sự mâu thuẫn quá lớn, phong trào phản kháng xã hội sẽ bùng nổ."
                          : "💡 General observation: These examples prove that 'national interests' are often labeled to legitimize ruling class interests. When contradictions become too large, social resistance movements will erupt."}
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Section 4: Lý giải sự xuất hiện phong trào phản kháng */}
              <div className="content-section">
                <h2 className="section-title">
                  {lang === "vi"
                    ? "4. Lý giải sự xuất hiện phong trào phản kháng"
                    : "4. Explaining the Emergence of Resistance Movements"}
                </h2>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "4.1 Nguyên nhân sâu xa"
                      : "4.1 Deep-rooted Causes"}
                  </h3>
                  <div className="content-box">
                    <p className="definition">
                      {lang === "vi"
                        ? "Mâu thuẫn giữa giai cấp thống trị (chính phủ, tập đoàn, tài phiệt) và giai cấp lao động tạo nên nguyên nhân sâu xa của các phong trào phản kháng."
                        : "Contradictions between the ruling class (government, corporations, oligarchy) and working class create deep-rooted causes of resistance movements."}
                    </p>
                    <div className="key-points">
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Mâu thuẫn cơ bản:"
                              : "Basic Contradiction:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Giữa lợi ích của giai cấp thống trị và lợi ích của đại đa số nhân dân"
                            : "Between ruling class interests and interests of the majority"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi" ? "Bản chất:" : "Nature:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Giai cấp thống trị sử dụng khái niệm 'lợi ích quốc gia' để che giấu lợi ích riêng"
                            : "Ruling class uses 'national interests' concept to disguise private interests"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi" ? "Hậu quả:" : "Consequence:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Tạo ra sự bất bình đẳng và bất công xã hội ngày càng gia tăng"
                            : "Creates increasing social inequality and injustice"}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "4.2 Nguyên nhân trực tiếp"
                      : "4.2 Direct Causes"}
                  </h3>
                  <div className="content-box">
                    <div className="key-points">
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Chính sách bất công:"
                              : "Unjust Policies:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Tăng thuế cho người dân, cắt giảm phúc lợi xã hội, dồn ngân sách cho quốc phòng thay vì y tế-giáo dục"
                            : "Tax increases for citizens, social welfare cuts, budget allocation to defense instead of healthcare-education"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Bất bình đẳng gia tăng:"
                              : "Growing Inequality:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Khoảng cách giàu nghèo ngày càng lớn, cơ hội xã hội bị độc quyền"
                            : "Growing wealth gap, monopolized social opportunities"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Thiếu đại diện:"
                              : "Lack of Representation:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Người dân cảm thấy tiếng nói của mình không được lắng nghe trong các quyết định chính sách"
                            : "Citizens feel their voices are not heard in policy decisions"}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi" ? "4.3 Hệ quả" : "4.3 Consequences"}
                  </h3>
                  <div className="content-box">
                    <div className="key-points">
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Cảm giác bị gạt ra ngoài:"
                              : "Feeling Excluded:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Người dân cảm thấy bị gạt ra ngoài cái gọi là 'lợi ích quốc gia'"
                            : "Citizens feel excluded from so-called 'national interests'"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Cơ chế tự vệ:"
                              : "Self-defense Mechanism:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Các phong trào phản kháng trở thành cơ chế tự vệ của xã hội"
                            : "Resistance movements become society's self-defense mechanism"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Thách thức hệ thống:"
                              : "System Challenge:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Đặt câu hỏi về tính chính đáng của giai cấp thống trị"
                            : "Questions the legitimacy of the ruling class"}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Section 5: Kết luận */}
              <div className="content-section">
                <h2 className="section-title">
                  {lang === "vi"
                    ? "5. Kết luận - Trả lời câu hỏi"
                    : "5. Conclusion - Answering the Question"}
                </h2>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "5.1 Trả lời câu hỏi đặt ra"
                      : "5.1 Answering the Posed Question"}
                  </h3>
                  <div className="content-box">
                    <div
                      style={{
                        background:
                          "linear-gradient(135deg, var(--accent-light), rgba(255, 215, 0, 0.1))",
                        padding: "2rem",
                        borderRadius: "var(--radius-lg)",
                        border: "3px solid var(--accent)",
                        textAlign: "center",
                        marginBottom: "2rem",
                      }}
                    >
                      <p
                        style={{
                          fontSize: "1.4rem",
                          fontWeight: "700",
                          color: "var(--accent-dark)",
                          margin: 0,
                          lineHeight: "1.5",
                        }}
                      >
                        {lang === "vi"
                          ? "🎯 KẾT LUẬN: 'Lợi ích quốc gia' KHÔNG mặc nhiên là lợi ích của mọi công dân"
                          : "🎯 CONCLUSION: 'National interests' are NOT automatically the interests of all citizens"}
                      </p>
                    </div>

                    <div className="key-points">
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Trong xã hội có giai cấp:"
                              : "In class society:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "'Quốc gia' thường được định hình bởi giai cấp cầm quyền"
                            : "'Nation' is often shaped by the ruling class"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Khi thống nhất:"
                              : "When unified:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Lợi ích giai cấp cầm quyền và lợi ích dân tộc thống nhất → nhân dân đồng lòng"
                            : "Ruling class and national interests align → people unite"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Khi mâu thuẫn:"
                              : "When contradictory:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Hai lợi ích này mâu thuẫn → xuất hiện phong trào phản kháng"
                            : "These interests conflict → resistance movements emerge"}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "5.2 Bài học thực tiễn"
                      : "5.2 Practical Lessons"}
                  </h3>
                  <div className="content-box">
                    <div
                      style={{
                        background: "var(--surface-light)",
                        padding: "1.5rem",
                        borderRadius: "var(--radius-lg)",
                        border: "2px solid var(--primary)",
                        marginBottom: "1.5rem",
                      }}
                    >
                      <p
                        style={{
                          fontSize: "1.2rem",
                          fontWeight: "600",
                          color: "var(--primary)",
                          margin: "0 0 1rem 0",
                          textAlign: "center",
                        }}
                      >
                        {lang === "vi"
                          ? "📚 Bài học quan trọng"
                          : "📚 Important Lesson"}
                      </p>
                      <p
                        style={{
                          fontSize: "1.1rem",
                          color: "var(--text)",
                          margin: 0,
                          textAlign: "center",
                          fontStyle: "italic",
                        }}
                      >
                        {lang === "vi"
                          ? "Một chính sách thực sự là 'lợi ích quốc gia' phải xuất phát từ nhu cầu của đại đa số nhân dân, chứ không chỉ phục vụ thiểu số."
                          : "A policy that is truly 'national interest' must originate from the needs of the vast majority of people, not just serve the minority."}
                      </p>
                    </div>

                    <div className="key-points">
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi" ? "Cho người dân:" : "For citizens:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Cần có tư duy phê phán khi đánh giá các chính sách được gắn nhãn 'lợi ích quốc gia'"
                            : "Need critical thinking when evaluating policies labeled as 'national interests'"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Cho nhà hoạch định chính sách:"
                              : "For policymakers:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Phải đảm bảo chính sách thực sự phục vụ lợi ích của đa số, không chỉ của nhóm quyền lực"
                            : "Must ensure policies truly serve majority interests, not just powerful groups"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Cho nghiên cứu xã hội:"
                              : "For social research:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Cần áp dụng phương pháp phân tích giai cấp để hiểu bản chất thực sự của các hiện tượng xã hội"
                            : "Need to apply class analysis methods to understand true nature of social phenomena"}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="subsection">
                  <h3 className="subsection-title">
                    {lang === "vi"
                      ? "5.3 Ý nghĩa của lý thuyết Marx-Lenin"
                      : "5.3 Significance of Marx-Lenin Theory"}
                  </h3>
                  <div className="content-box">
                    <p className="definition">
                      {lang === "vi"
                        ? "Lý thuyết Marx-Lenin về mối quan hệ giai cấp và dân tộc vẫn có giá trị thực tiễn cao trong việc phân tích các hiện tượng chính trị-xã hội đương đại."
                        : "Marx-Lenin theory on class and nation relationships still has high practical value in analyzing contemporary political-social phenomena."}
                    </p>
                    <div className="key-points">
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Công cụ phân tích:"
                              : "Analytical tool:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Giúp nhận diện bản chất giai cấp ẩn sau các khẩu hiệu 'lợi ích quốc gia'"
                            : "Helps identify class nature behind 'national interest' slogans"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Hướng dẫn thực tiễn:"
                              : "Practical guidance:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Cung cấp phương pháp luận để xây dựng chính sách thực sự vì nhân dân"
                            : "Provides methodology to build policies truly for the people"}
                        </span>
                      </div>
                      <div className="key-point">
                        <span className="point-text">
                          <strong>
                            {lang === "vi"
                              ? "Giá trị hiện đại:"
                              : "Modern value:"}
                          </strong>{" "}
                          {lang === "vi"
                            ? "Vẫn phù hợp để hiểu các phong trào xã hội và cuộc khủng hoảng chính trị hiện tại"
                            : "Still relevant for understanding current social movements and political crises"}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      function Articles({ lang }) {
        const S = STRINGS[lang];
        const items = [
          {
            id: "art-usa",
            title:
              lang === "vi"
                ? "Mỹ — 'We are the 99%' (2011)"
                : "USA — 'We are the 99%' (2011)",
            img: "img/Wall.jpg",
            brief:
              lang === "vi"
                ? "TT - Một nhóm các nhà hoạt động phong trào “Chiếm lấy Phố Wall” đã mua lại khoản nợ hơn 15 triệu USD của người dân Mỹ trong năm qua và xóa nợ cho họ."
                : "TT - A group of Occupy Wall Street activists bought more than $15 million in debt from Americans last year and canceled their debt.",
            source:
              "https://tuoitre.vn/chiem-lay-pho-wall-xoa-no-cho-dan-my-580416.htm",
            sourceLabel: "Tuổi Trẻ",
          },
          {
            id: "art-fr",
            title:
              lang === "vi"
                ? "Pháp — Áo Vàng (2018–2019)"
                : "France — Gilets Jaunes (2018–2019)",
            img: "img/Yellow.jpg",
            brief:
              lang === "vi"
                ? "TTO - Những người phản đối tăng giá xăng dầu ở Pháp đã sử dụng áo phản quang bảo hộ màu vàng làm dấu hiệu tập hợp. Các nhà nghiên cứu đã phân tích ba yếu tố cơ bản thúc đẩy họ xuống đường."
                : "TTO - Protesters against rising fuel prices in France used yellow reflective safety vests as rallying signals. Researchers have analyzed three basic factors that motivated them to take to the streets.",
            source:
              "https://tuoitre.vn/vi-dau-con-gian-ao-khoac-vang-o-phap-20181204153230927.htm",
            sourceLabel: "Tuổi Trẻ",
          },
          {
            id: "art-indo",
            title:
              lang === "vi"
                ? "Indonesia — Biểu tình sinh viên (2019)"
                : "Indonesia — Student Protests (2019)",
            img: "img/Student.jpg",
            brief:
              lang === "vi"
                ? "Ngày 2-9, cảnh sát Indonesia bắn hơi cay vào đám đông người biểu tình gần hai trường đại học ở thành phố Bandung, gây tranh cãi về vấn đề nhân quyền."
                : "On September 2, Indonesian police fired tear gas into a crowd of protesters near two universities in Bandung city, sparking controversy over human rights issues.",
            source:
              "https://tuoitre.vn/bieu-tinh-indonesia-canh-sat-ban-hoi-cay-gan-truong-dai-hoc-cac-to-chuc-nhan-quyen-phan-no-20250902140300585.htm",
            sourceLabel: "Tuổi Trẻ",
          },
        ];

        return (
          <div className="articles-content">
            <div className="articles-section">
              <div className="articles-grid">
                {items.map((article, index) => (
                  <article
                    key={article.id}
                    className={`article-card modern-article article-${
                      index + 1
                    }`}
                  >
                    <div className="article-image-container">
                      <img
                        className="article-image"
                        alt="Article illustration"
                        src={article.img}
                      />
                      <div className="image-overlay">
                        <div className="article-category">
                          {index === 0
                            ? lang === "vi"
                              ? "Kinh tế"
                              : "Economy"
                            : index === 1
                            ? lang === "vi"
                              ? "Chính trị"
                              : "Politics"
                            : lang === "vi"
                            ? "Xã hội"
                            : "Society"}
                        </div>
                        <div className="read-time">
                          <span className="read-icon">📖</span>
                          {index === 0
                            ? "3 min"
                            : index === 1
                            ? "4 min"
                            : "5 min"}
                        </div>
                      </div>
                    </div>

                    <div className="article-content">
                      <div className="article-header">
                        <div className="article-number">
                          {String(index + 1).padStart(2, "0")}
                        </div>
                        <h3 className="article-title">{article.title}</h3>
                      </div>

                      <p className="article-brief">{article.brief}</p>

                      <div className="article-footer">
                        <div className="article-source">
                          <span className="source-label">
                            {article.sourceLabel}
                          </span>
                        </div>
                        <a
                          className="read-more-btn"
                          href={article.source}
                          target="_blank"
                          rel="noreferrer"
                        >
                          <span className="btn-text">{S.read}</span>
                          <span className="btn-arrow">→</span>
                        </a>
                      </div>
                    </div>
                  </article>
                ))}
              </div>

              {/* Featured Content */}
              <div className="featured-content">
                <div className="featured-header">
                  <h3 className="featured-title">
                    {lang === "vi" ? "Khám phá thêm" : "Explore More"}
                  </h3>
                  <p className="featured-desc">
                    {lang === "vi"
                      ? "Tìm hiểu thêm về các chủ đề chính trị và xã hội thông qua mô phỏng tương tác."
                      : "Learn more about political and social topics through interactive simulations."}
                  </p>
                </div>

                <div className="featured-actions">
                  <button
                    className="featured-btn primary"
                    onClick={() => setPage("sim")}
                  >
                    <span className="btn-icon">🎮</span>
                    {lang === "vi" ? "Mô phỏng Chính sách" : "Policy Simulator"}
                  </button>
                  <button
                    className="featured-btn secondary"
                    onClick={() => setPage("cases")}
                  >
                    <span className="btn-icon">📚</span>
                    {lang === "vi" ? "Case Studies" : "Case Studies"}
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      function Quiz({ lang }) {
        const [currentQuestion, setCurrentQuestion] = React.useState(0);
        const [answers, setAnswers] = React.useState({});
        const [showResults, setShowResults] = React.useState(false);
        const [selectedAnswer, setSelectedAnswer] = React.useState(null);
        const [showExplanation, setShowExplanation] = React.useState(false);

        const questions = QUIZ_QUESTIONS[lang];
        const currentQ = questions[currentQuestion];

        const handleAnswerSelect = (optionIndex) => {
          setSelectedAnswer(optionIndex);
          setAnswers((prev) => ({
            ...prev,
            [currentQuestion]: optionIndex,
          }));
        };

        const handleNext = () => {
          if (selectedAnswer !== null) {
            setShowExplanation(true);
          }
        };

        const handleContinue = () => {
          if (currentQuestion < questions.length - 1) {
            setCurrentQuestion((prev) => prev + 1);
            setSelectedAnswer(null);
            setShowExplanation(false);
          } else {
            setShowResults(true);
          }
        };

        const calculateScore = () => {
          let correct = 0;
          questions.forEach((q, index) => {
            if (answers[index] === q.correct) {
              correct++;
            }
          });
          return correct;
        };

        const resetQuiz = () => {
          setCurrentQuestion(0);
          setAnswers({});
          setShowResults(false);
          setSelectedAnswer(null);
          setShowExplanation(false);
        };

        const getScoreColor = (score, total) => {
          const percentage = (score / total) * 100;
          if (percentage >= 80) return "#27ae60";
          if (percentage >= 60) return "#f39c12";
          return "#e74c3c";
        };

        if (showResults) {
          const score = calculateScore();
          const total = questions.length;
          const percentage = Math.round((score / total) * 100);

          return (
            <div className="quiz-page">
              <div className="page-hero">
                <div className="page-hero-content">
                  <h1 className="page-title">
                    🎯 {lang === "vi" ? "Kết quả Quiz" : "Quiz Results"}
                  </h1>
                  <p className="page-description">
                    {lang === "vi"
                      ? "Bạn đã hoàn thành bài quiz về Giai cấp và Dân tộc!"
                      : "You have completed the Class and Nation quiz!"}
                  </p>
                </div>
              </div>

              <div className="quiz-results">
                <div className="score-card">
                  <div
                    className="score-circle"
                    style={{ borderColor: getScoreColor(score, total) }}
                  >
                    <div
                      className="score-number"
                      style={{ color: getScoreColor(score, total) }}
                    >
                      {score}/{total}
                    </div>
                    <div
                      className="score-percentage"
                      style={{ color: getScoreColor(score, total) }}
                    >
                      {percentage}%
                    </div>
                  </div>
                  <h3 className="score-title">
                    {percentage >= 80
                      ? lang === "vi"
                        ? "Xuất sắc!"
                        : "Excellent!"
                      : percentage >= 60
                      ? lang === "vi"
                        ? "Tốt!"
                        : "Good!"
                      : lang === "vi"
                      ? "Cần cố gắng thêm!"
                      : "Keep trying!"}
                  </h3>
                  <p className="score-description">
                    {lang === "vi"
                      ? `Bạn đã trả lời đúng ${score} trên ${total} câu hỏi.`
                      : `You answered ${score} out of ${total} questions correctly.`}
                  </p>
                </div>

                <div className="quiz-actions">
                  <button className="btn btn-primary" onClick={resetQuiz}>
                    🔄 {lang === "vi" ? "Làm lại Quiz" : "Retake Quiz"}
                  </button>
                  <button
                    className="btn btn-secondary"
                    onClick={() => window.location.reload()}
                  >
                    🏠 {lang === "vi" ? "Về trang chủ" : "Go Home"}
                  </button>
                </div>

                <div className="answer-review">
                  <h3>
                    📋 {lang === "vi" ? "Xem lại đáp án:" : "Review Answers:"}
                  </h3>
                  {questions.map((q, index) => (
                    <div
                      key={q.id}
                      className={`review-item ${
                        answers[index] === q.correct ? "correct" : "incorrect"
                      }`}
                    >
                      <div className="review-header">
                        <span className="question-number">
                          {lang === "vi" ? "Câu" : "Q"} {index + 1}
                        </span>
                        <span
                          className={`result-icon ${
                            answers[index] === q.correct
                              ? "correct"
                              : "incorrect"
                          }`}
                        >
                          {answers[index] === q.correct ? "✅" : "❌"}
                        </span>
                      </div>
                      <p className="review-question">{q.question}</p>
                      <p className="review-answer">
                        <strong>
                          ✅{" "}
                          {lang === "vi" ? "Đáp án đúng:" : "Correct answer:"}
                        </strong>
                        <span
                          style={{
                            color: "#27ae60",
                            fontWeight: "bold",
                            marginLeft: "0.5rem",
                          }}
                        >
                          {String.fromCharCode(65 + q.correct)}.{" "}
                          {q.options[q.correct]}
                        </span>
                      </p>
                      {answers[index] !== q.correct && (
                        <p className="review-wrong">
                          <strong>
                            ❌{" "}
                            {lang === "vi" ? "Bạn đã chọn:" : "You selected:"}
                          </strong>
                          <span
                            style={{
                              color: "#e74c3c",
                              fontWeight: "bold",
                              marginLeft: "0.5rem",
                            }}
                          >
                            {String.fromCharCode(65 + answers[index])}.{" "}
                            {q.options[answers[index]]}
                          </span>
                        </p>
                      )}
                      <div
                        style={{
                          marginTop: "1rem",
                          padding: "1rem",
                          background: "rgba(255, 215, 0, 0.1)",
                          borderRadius: "8px",
                          borderLeft: "4px solid var(--accent)",
                        }}
                      >
                        <strong style={{ color: "var(--accent)" }}>
                          💡 {lang === "vi" ? "Giải thích:" : "Explanation:"}
                        </strong>
                        <p
                          style={{ margin: "0.5rem 0 0 0", lineHeight: "1.6" }}
                        >
                          {q.explanation}
                        </p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          );
        }

        return (
          <div className="quiz-page">
            <div className="page-hero">
              <div className="page-hero-content">
                <div className="hero-highlight">
                  {lang === "vi" ? "Trắc nghiệm" : "Quiz"}
                </div>
                <h1 className="page-title">
                  {lang === "vi"
                    ? "Quiz: Giai cấp và Dân tộc"
                    : "Quiz: Class and Nation"}
                </h1>
                <p className="page-description">
                  {lang === "vi"
                    ? "Kiểm tra kiến thức của bạn về lý thuyết Marx-Lenin về giai cấp, dân tộc và mối quan hệ của chúng."
                    : "Test your knowledge of Marx-Lenin theory on class, nation and their relationships."}
                </p>
              </div>
            </div>

            <div className="quiz-container">
              <div className="quiz-progress">
                <div className="progress-bar">
                  <div
                    className="progress-fill"
                    style={{
                      width: `${
                        ((currentQuestion + 1) / questions.length) * 100
                      }%`,
                    }}
                  ></div>
                </div>
                <span className="progress-text">
                  {lang === "vi" ? "Câu" : "Question"} {currentQuestion + 1} /{" "}
                  {questions.length}
                </span>
              </div>

              <div className="question-card">
                <h2 className="question-title">{currentQ.question}</h2>

                <div className="options-list">
                  {currentQ.options.map((option, index) => (
                    <button
                      key={index}
                      className={`option-btn ${
                        selectedAnswer === index ? "selected" : ""
                      } ${
                        showExplanation
                          ? index === currentQ.correct
                            ? "correct"
                            : selectedAnswer === index &&
                              index !== currentQ.correct
                            ? "incorrect"
                            : ""
                          : ""
                      }`}
                      onClick={() =>
                        !showExplanation && handleAnswerSelect(index)
                      }
                      disabled={showExplanation}
                    >
                      <span className="option-letter">
                        {String.fromCharCode(65 + index)}
                      </span>
                      <span className="option-text">{option}</span>
                      {showExplanation && (
                        <span className="option-icon">
                          {index === currentQ.correct
                            ? "✅"
                            : selectedAnswer === index &&
                              index !== currentQ.correct
                            ? "❌"
                            : ""}
                        </span>
                      )}
                    </button>
                  ))}
                </div>

                {showExplanation && (
                  <div className="explanation-box">
                    <h4>💡 {lang === "vi" ? "Giải thích:" : "Explanation:"}</h4>
                    <p>{currentQ.explanation}</p>
                    {selectedAnswer === currentQ.correct ? (
                      <div
                        style={{
                          marginTop: "1rem",
                          padding: "0.8rem",
                          background: "rgba(39, 174, 96, 0.1)",
                          borderRadius: "8px",
                          color: "#27ae60",
                          fontWeight: "bold",
                          textAlign: "center",
                        }}
                      >
                        🎉{" "}
                        {lang === "vi"
                          ? "Chính xác! Bạn đã trả lời đúng!"
                          : "Correct! You got it right!"}
                      </div>
                    ) : (
                      <div
                        style={{
                          marginTop: "1rem",
                          padding: "0.8rem",
                          background: "rgba(231, 76, 60, 0.1)",
                          borderRadius: "8px",
                          color: "#e74c3c",
                          fontWeight: "bold",
                          textAlign: "center",
                        }}
                      >
                        💪{" "}
                        {lang === "vi"
                          ? "Chưa đúng, nhưng đừng lo! Hãy học từ sai lầm."
                          : "Not quite right, but don't worry! Learn from mistakes."}
                      </div>
                    )}
                  </div>
                )}

                <div className="question-actions">
                  {!showExplanation ? (
                    <button
                      className="btn btn-primary"
                      onClick={handleNext}
                      disabled={selectedAnswer === null}
                    >
                      {currentQuestion === questions.length - 1
                        ? lang === "vi"
                          ? "Hoàn thành"
                          : "Finish"
                        : lang === "vi"
                        ? "Trả lời"
                        : "Answer"}
                    </button>
                  ) : (
                    <button
                      className="btn btn-success"
                      onClick={handleContinue}
                    >
                      {currentQuestion === questions.length - 1
                        ? lang === "vi"
                          ? "🎯 Xem kết quả"
                          : "🎯 View Results"
                        : lang === "vi"
                        ? "➡️ Câu tiếp theo"
                        : "➡️ Next Question"}
                    </button>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      function App() {
        const [lang, setLang] = React.useState("vi");
        const [page, setPage] = React.useState("home"); // 'home' | 'intro' | 'cases' | 'sim' | 'articles' | 'presentation' | 'quiz'
        const S = STRINGS[lang];

        return (
          <>
            <NavBar
              lang={lang}
              setLang={setLang}
              page={page}
              setPage={setPage}
            />
            <div className="container">
              {page === "intro" && (
                <div className="intro-page">
                  {/* Intro Hero Section */}
                  <div className="page-hero">
                    <div className="page-hero-content">
                      <div className="hero-highlight">{S.nav.intro}</div>
                      <h1 className="page-title">{S.introTitle}</h1>
                      <p className="page-description">
                        {lang === "en"
                          ? "Master the art of governance in our comprehensive policy simulation game. Learn how government decisions impact society, economy, and political stability."
                          : "Làm chủ nghệ thuật quản trị trong game mô phỏng chính sách toàn diện. Tìm hiểu cách quyết định của chính phủ ảnh hưởng đến xã hội, kinh tế và ổn định chính trị."}
                      </p>
                    </div>
                  </div>

                  {/* Intro Content Grid */}
                  <div className="intro-content">
                    <div className="intro-grid">
                      {/* Game Overview */}
                      <div className="intro-card overview-card">
                        <div className="card-header">
                          <div className="card-accent overview-accent"></div>
                          <h3 className="intro-card-title">
                            {lang === "en" ? "Game Overview" : "Tổng quan Game"}
                          </h3>
                        </div>
                        <div className="intro-card-content">
                          <div className="intro-point">
                            <div className="point-number">01</div>
                            <div className="point-content">
                              <h4>
                                {lang === "en"
                                  ? "Your Role"
                                  : "Vai trò của bạn"}
                              </h4>
                              <p>{S.intro[0]}</p>
                            </div>
                          </div>
                          <div className="intro-point">
                            <div className="point-number">02</div>
                            <div className="point-content">
                              <h4>
                                {lang === "en"
                                  ? "Key Indicators"
                                  : "Chỉ số chính"}
                              </h4>
                              <p>{S.intro[1]}</p>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Gameplay Mechanics */}
                      <div className="intro-card mechanics-card">
                        <div className="card-header">
                          <div className="card-accent mechanics-accent"></div>
                          <h3 className="intro-card-title">
                            {lang === "en" ? "How to Play" : "Cách chơi"}
                          </h3>
                        </div>
                        <div className="intro-card-content">
                          <div className="intro-point">
                            <div className="point-number">03</div>
                            <div className="point-content">
                              <h4>
                                {lang === "en"
                                  ? "Social Groups"
                                  : "Nhóm xã hội"}
                              </h4>
                              <p>{S.intro[2]}</p>
                            </div>
                          </div>
                          <div className="intro-point">
                            <div className="point-number">04</div>
                            <div className="point-content">
                              <h4>
                                {lang === "en"
                                  ? "Turn System"
                                  : "Hệ thống lượt"}
                              </h4>
                              <p>{S.intro[3]}</p>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Social Dynamics */}
                      <div className="intro-card dynamics-card">
                        <div className="card-header">
                          <div className="card-accent dynamics-accent"></div>
                          <h3 className="intro-card-title">
                            {lang === "en"
                              ? "Political Dynamics"
                              : "Động lực Chính trị"}
                          </h3>
                        </div>
                        <div className="intro-card-content">
                          <div className="intro-point">
                            <div className="point-number">05</div>
                            <div className="point-content">
                              <h4>
                                {lang === "en"
                                  ? "Social Reactions"
                                  : "Phản ứng xã hội"}
                              </h4>
                              <p>{S.intro[4]}</p>
                            </div>
                          </div>
                          <div className="intro-point">
                            <div className="point-number">06</div>
                            <div className="point-content">
                              <h4>
                                {lang === "en"
                                  ? "Government Response"
                                  : "Phản ứng Chính phủ"}
                              </h4>
                              <p>{S.intro[5]}</p>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Win/Lose Conditions */}
                      <div className="intro-card conditions-card">
                        <div className="card-header">
                          <div className="card-accent conditions-accent"></div>
                          <h3 className="intro-card-title">
                            {lang === "en"
                              ? "Victory & Defeat"
                              : "Thắng & Thua"}
                          </h3>
                        </div>
                        <div className="intro-card-content">
                          <div className="intro-point success-point">
                            <div className="point-indicator success-indicator">
                              ✓
                            </div>
                            <div className="point-content">
                              <h4>
                                {lang === "en"
                                  ? "Winning Conditions"
                                  : "Điều kiện thắng"}
                              </h4>
                              <p>{S.intro[6]}</p>
                            </div>
                          </div>
                          <div className="intro-point danger-point">
                            <div className="point-indicator danger-indicator">
                              ✗
                            </div>
                            <div className="point-content">
                              <h4>
                                {lang === "en"
                                  ? "Losing Conditions"
                                  : "Điều kiện thua"}
                              </h4>
                              <p>{S.intro[7]}</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Call to Action */}
                    <div className="intro-cta">
                      <div className="cta-content">
                        <h3 className="cta-title">
                          {lang === "en"
                            ? "Ready to Govern?"
                            : "Sẵn sàng Điều hành?"}
                        </h3>
                        <p className="cta-description">
                          {lang === "en"
                            ? "Put your political skills to the test. Start your journey as a leader and see if you can balance the competing demands of a modern democracy."
                            : "Thử thách kỹ năng chính trị của bạn. Bắt đầu hành trình làm lãnh đạo và xem bạn có thể cân bằng các yêu cầu cạnh tranh của một nền dân chủ hiện đại không."}
                        </p>
                        <div className="cta-buttons">
                          <button
                            className="btn btn-primary"
                            onClick={() => setPage("sim")}
                          >
                            {lang === "en"
                              ? "Start Simulation"
                              : "Bắt đầu Mô phỏng"}
                          </button>
                          <button
                            className="btn btn-secondary"
                            onClick={() => setPage("cases")}
                          >
                            {lang === "en"
                              ? "View Case Studies"
                              : "Xem Nghiên cứu Trường hợp"}
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {page === "home" && (
                <>
                  {/* Hero Section with Enhanced Design */}
                  <div className="hero">
                    <div className="hero-content">
                      <div className="hero-badge">
                        <span className="badge-text">{S.shockBadge}</span>
                      </div>
                      <h1 className="hero-title">{S.title}</h1>
                      <p className="hero-description">{S.tagline}</p>
                      <div className="hero-stats">
                        <div className="stat-item">
                          <span className="stat-number">3</span>
                          <span className="stat-label">Case Studies</span>
                        </div>
                        <div className="stat-divider"></div>
                        <div className="stat-item">
                          <span className="stat-number">4</span>
                          <span className="stat-label">Roles</span>
                        </div>
                        <div className="stat-divider"></div>
                        <div className="stat-item">
                          <span className="stat-number">18</span>
                          <span className="stat-label">Policies</span>
                        </div>
                      </div>
                    </div>
                    <div className="hero-actions">
                      <button
                        className="btn btn-primary hero-btn"
                        onClick={() => setPage("sim")}
                      >
                        {S.play}
                      </button>
                      <button
                        className="btn btn-secondary hero-btn"
                        onClick={() => setPage("cases")}
                      >
                        {S.ctaCases}
                      </button>
                      <button
                        className="btn btn-ghost hero-btn"
                        onClick={() => setPage("articles")}
                      >
                        {S.ctaArticles}
                      </button>
                    </div>
                  </div>

                  {/* Features Grid */}
                  <div className="features-section">
                    <h2 className="section-title">
                      Explore Political Dynamics
                    </h2>
                    <div className="features-grid">
                      {/* Theory Card */}
                      <div className="feature-card theory-card">
                        <div className="card-header">
                          <div className="card-accent theory-accent"></div>
                        </div>
                        <div className="card-content">
                          <h3 className="card-title">{S.theoryTitle}</h3>
                          <ul className="theory-points">
                            {S.theoryPoints.map((t, i) => (
                              <li key={i} className="theory-point">
                                <span className="point-marker">→</span>
                                <span className="point-text">{t}</span>
                              </li>
                            ))}
                          </ul>
                        </div>
                        <div className="card-footer">
                          <span className="card-tag">Political Theory</span>
                        </div>
                      </div>

                      {/* Quick Start Card */}
                      <div className="feature-card quickstart-card">
                        <div className="card-header">
                          <div className="card-accent quickstart-accent"></div>
                        </div>
                        <div className="card-content">
                          <h3 className="card-title">
                            {lang === "vi" ? "Bắt đầu nhanh" : "Quick Start"}
                          </h3>
                          <p className="card-description">
                            {lang === "vi"
                              ? "Trải nghiệm mô phỏng chính sách và khám phá xung đột lợi ích giữa các nhóm xã hội."
                              : "Experience policy simulation and explore conflicts of interest between social groups."}
                          </p>
                          <div className="feature-list">
                            <div className="feature-item">
                              <span className="feature-bullet">•</span>
                              <span>
                                {lang === "vi" ? "Chọn vai trò" : "Choose Role"}
                              </span>
                            </div>
                            <div className="feature-item">
                              <span className="feature-bullet">•</span>
                              <span>
                                {lang === "vi"
                                  ? "Mô phỏng tức thời"
                                  : "Instant Simulation"}
                              </span>
                            </div>
                            <div className="feature-item">
                              <span className="feature-bullet">•</span>
                              <span>
                                {lang === "vi"
                                  ? "Phân tích kết quả"
                                  : "Analyze Results"}
                              </span>
                            </div>
                          </div>
                        </div>
                        <div className="card-footer">
                          <button
                            className="card-action-btn"
                            onClick={() => setPage("sim")}
                          >
                            {lang === "vi" ? "Bắt đầu →" : "Get Started →"}
                          </button>
                        </div>
                      </div>

                      {/* Learning Card */}
                      <div className="feature-card learning-card">
                        <div className="card-header">
                          <div className="card-accent learning-accent"></div>
                        </div>
                        <div className="card-content">
                          <h3 className="card-title">
                            {lang === "vi"
                              ? "Tài liệu học tập"
                              : "Learning Resources"}
                          </h3>
                          <p className="card-description">
                            {lang === "vi"
                              ? "Khám phá các case study thực tế và bài viết phân tích sâu về chính trị."
                              : "Explore real case studies and in-depth analysis articles on politics."}
                          </p>
                          <div className="resource-stats">
                            <div className="resource-item">
                              <span className="resource-count">3</span>
                              <span className="resource-label">
                                Case Studies
                              </span>
                            </div>
                            <div className="resource-item">
                              <span className="resource-count">12</span>
                              <span className="resource-label">Articles</span>
                            </div>
                          </div>
                        </div>
                        <div className="card-footer">
                          <div className="action-buttons">
                            <button
                              className="mini-btn"
                              onClick={() => setPage("cases")}
                            >
                              Cases
                            </button>
                            <button
                              className="mini-btn"
                              onClick={() => setPage("articles")}
                            >
                              Articles
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </>
              )}

              {page === "cases" && (
                <>
                  {/* Case Studies Hero */}
                  <div className="page-hero cases-hero">
                    <div className="page-hero-content">
                      <h1 className="page-title">{S.caseStudiesTitle}</h1>
                      <p className="page-description">{S.caseStudiesDesc}</p>
                      <div className="hero-highlight">
                        <span className="highlight-text">
                          {lang === "vi"
                            ? "3 Case Study Thực Tế"
                            : "3 Real Case Studies"}
                        </span>
                      </div>
                    </div>
                  </div>

                  {/* Case Studies Grid */}
                  <div className="cases-section">
                    <div className="cases-grid">
                      <CaseStudies lang={lang} />
                    </div>
                  </div>
                </>
              )}

              {page === "sim" && (
                <div className="policy-simulator-page">
                  {/* Simulator Hero Section */}
                  <div className="page-hero">
                    <div className="page-hero-content">
                      <div className="hero-highlight">{S.nav.sim}</div>
                      <h1 className="page-title">{S.policySimulatorTitle}</h1>
                      <p className="page-description">
                        {S.policySimulatorDesc}
                      </p>
                    </div>
                  </div>

                  <PolicySimulator lang={lang} />
                </div>
              )}

              {page === "articles" && (
                <div className="articles-page">
                  {/* Articles Hero Section */}
                  <div className="page-hero articles-hero">
                    <div className="page-hero-content">
                      <div className="hero-highlight">{S.nav.articles}</div>
                      <h1 className="page-title">{S.articlesTitle}</h1>
                      <p className="page-description">{S.articlesDesc}</p>
                      <div className="articles-stats">
                        <div className="articles-stat">
                          <span className="stat-number">3</span>
                          <span className="stat-label">
                            {lang === "vi" ? "Bài viết" : "Articles"}
                          </span>
                        </div>
                        <div className="stat-divider"></div>
                        <div className="articles-stat">
                          <span className="stat-number">12</span>
                          <span className="stat-label">
                            {lang === "vi" ? "Hình ảnh" : "Images"}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <Articles lang={lang} />
                </div>
              )}

              {page === "presentation" && (
                <div className="presentation-page">
                  <PresentationPage lang={lang} />
                </div>
              )}

              {page === "quiz" && (
                <div className="quiz-page">
                  <Quiz lang={lang} />
                </div>
              )}

              <div className="footer">Built by group FANMU with ♡</div>
            </div>
          </>
        );
      }

      const container = document.getElementById("root");
      if (window.ReactDOM && typeof ReactDOM.createRoot === "function") {
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
      } else if (window.ReactDOM && typeof ReactDOM.render === "function") {
        ReactDOM.render(<App />, container);
      } else {
        const diag = document.getElementById("diag");
        if (diag) {
          diag.style.display = "block";
          diag.textContent =
            "ReactDOM failed to initialize. Please check CDN connectivity.";
        }
      }
    </script>

    <!-- Unified Chat Button -->
    <div id="unified-chat-button">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H5.17L4 17.17V4H20V16Z"
          fill="currentColor"
        />
        <circle cx="7" cy="9" r="1" fill="currentColor" />
        <circle cx="12" cy="9" r="1" fill="currentColor" />
        <circle cx="17" cy="9" r="1" fill="currentColor" />
      </svg>
      <span>Trợ lý AI</span>
    </div>

    <!-- Unified Chatbot Container -->
    <div id="unified-chatbot-container" style="display: none">
      <!-- Chatbot Header with Tabs -->
      <div class="chatbot-header">
        <div class="chatbot-tabs">
          <button id="game-tab" class="tab-button active">🎮 Game</button>
          <button id="lesson-tab" class="tab-button">📚 Bài học</button>
        </div>
        <button id="close-unified-chat" type="button">×</button>
      </div>

      <!-- Tab Contents -->
      <div class="tab-content">
        <!-- Game Chat Tab -->
        <div id="game-chat-tab" class="chat-tab active">
          <div id="game-chat-messages" class="chat-messages"></div>
          <div class="chat-input-container">
            <input
              type="text"
              id="game-chat-input"
              placeholder="Hỏi về game..."
            />
            <button id="send-game-message">Gửi</button>
          </div>
        </div>

        <!-- Lesson Chat Tab -->
        <div id="lesson-chat-tab" class="chat-tab">
          <iframe
            id="lesson-chatbot-iframe"
            src="https://bot.writesonic.com/share/bot/64ee0a9c-f251-4ac3-8e69-b4c7f1827ce0"
            frameborder="0"
            allowtransparency="true"
          >
          </iframe>
        </div>
      </div>
    </div>

    <!-- Game Assistant Script -->
    <script src="game-assistant.js"></script>

    <script>
      // Unified Chat functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Unified Chat Elements
        const unifiedChatButton = document.getElementById(
          "unified-chat-button"
        );
        const unifiedChatContainer = document.getElementById(
          "unified-chatbot-container"
        );
        const closeUnifiedChatButton =
          document.getElementById("close-unified-chat");

        // Tab Elements
        const gameTab = document.getElementById("game-tab");
        const lessonTab = document.getElementById("lesson-tab");
        const gameChatTab = document.getElementById("game-chat-tab");
        const lessonChatTab = document.getElementById("lesson-chat-tab");

        // Game Chat Elements
        const gameChatInput = document.getElementById("game-chat-input");
        const sendGameMessageButton =
          document.getElementById("send-game-message");
        const gameChatMessages = document.getElementById("game-chat-messages");

        // Lesson Chat Elements
        const lessonChatIframe = document.getElementById(
          "lesson-chatbot-iframe"
        );

        // Store current game context for chatbot
        window.currentGameContext = null;

        // Initialize Game Assistant
        window.gameAssistant = new GameAssistant();

        // Function to update chatbot context from React component
        window.updateChatbotContext = function (context) {
          const prevContext = window.currentGameContext;
          window.currentGameContext = context;

          // Update GameAssistant context too
          if (window.gameAssistant) {
            window.gameAssistant.updateContext(context);
          }

          // Auto-suggest help if critical situations detected
          if (context && prevContext && isUnifiedChatOpen()) {
            checkForCriticalSituations(context, prevContext);
          }

          // Auto-analysis when a new policy is applied
          if (
            context &&
            prevContext &&
            context.selectedPolicy !== prevContext.selectedPolicy &&
            context.currentTurn > prevContext.currentTurn
          ) {
            setTimeout(() => {
              autoAnalyzeAfterPolicy(context);
            }, 2000);
          }

          console.log("Game context updated for chatbot:", context);
        };

        // Auto-analysis after policy selection
        function autoAnalyzeAfterPolicy(context) {
          if (!isUnifiedChatOpen()) return;

          const recentEvent = context.recentEvents && context.recentEvents[0];
          if (!recentEvent || recentEvent.type !== "policy") return;

          let analysisMessage = `🎯 **PHÂN TÍCH SAU CHÍNH SÁCH:**\n\n`;
          analysisMessage += `📋 Vừa thực hiện: **${recentEvent.title}**\n`;

          if (recentEvent.conflictAnalysis) {
            const conflict = recentEvent.conflictAnalysis;
            analysisMessage += `📊 Mức xung đột: **${conflict.conflictLevel}**\n`;

            if (conflict.benefitGroup) {
              analysisMessage += `✅ Nhóm được lợi: ${conflict.benefitGroup}\n`;
            }
            if (conflict.lossGroup) {
              analysisMessage += `❌ Nhóm thiệt hại: ${conflict.lossGroup}\n`;
            }
          }

          // Check for immediate problems
          const problems = [];
          const indicators = context.currentIndicators || {};

          if (indicators.unemployment > 75)
            problems.push("Thất nghiệp quá cao");
          if (indicators.gini > 75) problems.push("Bất bình đẳng nghiêm trọng");
          if (indicators.gdp < 25) problems.push("GDP rất thấp");
          if (indicators.legitimacy < 25) problems.push("Uy tín suy giảm");

          if (problems.length > 0) {
            analysisMessage += `\n⚠️ **VẤN ĐỀ CẦN CHÚ Ý:**\n${problems
              .map((p) => `• ${p}`)
              .join("\n")}`;
          }

          const suggestions = [
            "Phân tích chi tiết",
            "Gợi ý lượt tiếp theo",
            "Xem nhật ký sự kiện",
          ];
          addMessage(analysisMessage, false, suggestions);
        }

        // Check if unified chat is currently open
        function isUnifiedChatOpen() {
          const chatContainer = document.getElementById(
            "unified-chatbot-container"
          );
          const gameTab = document.getElementById("game-chat-tab");
          return (
            chatContainer &&
            chatContainer.style.display !== "none" &&
            gameTab &&
            gameTab.style.display !== "none"
          );
        }

        // Auto-detect critical situations and offer help
        function checkForCriticalSituations(newContext, oldContext) {
          if (!newContext || !oldContext) return;

          const criticalThreshold = 30; // Ngưỡng cảnh báo hợp lý
          let alerts = [];
          let suggestions = [];

          // Kiểm tra chỉ số theo đúng luật chơi
          const indicators = newContext.currentIndicators || {};
          const oldIndicators = oldContext.currentIndicators || {};

          // Chỉ số cao = tốt (GDP, uy tín, quân sự)
          if (indicators.gdp < 30 && oldIndicators.gdp >= 30) {
            alerts.push("📉 GDP đã giảm xuống mức nguy hiểm!");
            suggestions.push("Cách tăng GDP", "Chính sách kinh tế");
          }
          if (indicators.legitimacy < 30 && oldIndicators.legitimacy >= 30) {
            alerts.push("🏛️ Uy tín chính phủ đang suy giảm nghiêm trọng!");
            suggestions.push("Cách tăng uy tín", "Phân tích tình hình");
          }

          // Chỉ số thấp = tốt (thất nghiệp, bất bình đẳng)
          if (
            indicators.unemployment > 70 &&
            oldIndicators.unemployment <= 70
          ) {
            alerts.push("💼 Tỷ lệ thất nghiệp đang tăng vọt!");
            suggestions.push("Giảm thất nghiệp", "Tạo việc làm");
          }
          if (indicators.gini > 70 && oldIndicators.gini <= 70) {
            alerts.push("⚖️ Bất bình đẳng xã hội gia tăng!");
            suggestions.push("Giảm bất bình đẳng", "Công bằng xã hội");
          }

          // Kiểm tra nhóm xã hội không hài lòng
          const socialGroups = newContext.currentSocialGroups || {};
          const unhappyGroups = Object.entries(socialGroups)
            .filter(([group, satisfaction]) => satisfaction < 25)
            .map(([group]) => group);

          if (unhappyGroups.length > 0) {
            alerts.push(
              `👥 Các nhóm xã hội không hài lòng: ${unhappyGroups.join(", ")}`
            );
            suggestions.push("Cách xử lý xung đột", "Phân tích nhóm xã hội");
          }

          // Tự động hiển thị phân tích nếu có vấn đề nghiêm trọng
          if (alerts.length > 0) {
            setTimeout(() => {
              const analysisMessage = `🔍 **PHÂN TÍCH TÌNH HÌNH TỰ ĐỘNG:**\n\n${alerts.join(
                "\n"
              )}\n\n💡 **Cần hỗ trợ?** Hãy click vào gợi ý bên dưới:`;

              addMessage(analysisMessage, false, suggestions.slice(0, 3));
            }, 1500);
          }
        }

        // Kiểm tra chỉ số nguy hiểm theo đúng luật chơi
        function checkCriticalIndicators(indicators) {
          if (!indicators) return false;

          // Các chỉ số càng CAO càng tốt (dưới 25 là nguy hiểm)
          const higherIsBetter = [
            "gdp",
            "legitimacy",
            "military",
            "publicServices",
          ];

          // Các chỉ số càng THẤP càng tốt (trên 75 là nguy hiểm)
          const lowerIsBetter = ["unemployment", "gini"];

          // Kiểm tra chỉ số cao = tốt
          for (const indicator of higherIsBetter) {
            if (indicators[indicator] && indicators[indicator] < 25) {
              return true;
            }
          }

          // Kiểm tra chỉ số thấp = tốt
          for (const indicator of lowerIsBetter) {
            if (indicators[indicator] && indicators[indicator] > 75) {
              return true;
            }
          }

          return false;
        }

        // Function to handle suggestion clicks
        window.askQuestion = function (question) {
          // Add the question as user message
          addMessage(question, true);

          // Get bot response
          setTimeout(() => {
            const response = getBotResponse(question);
            addMessage(response, false);
          }, 300);
        };

        // Original addMessage function for backward compatibility
        function addMessage(message, isUser, suggestions = []) {
          const messagesContainer = document.getElementById("game-messages");
          if (!messagesContainer) return;

          const messageDiv = document.createElement("div");
          messageDiv.className = `message ${isUser ? "user" : "bot"}`;

          if (isUser) {
            messageDiv.innerHTML = `<div class="message-content">${message}</div>`;
          } else {
            let content = `<div class="message-content">${message}</div>`;

            // Add suggestion buttons if provided
            if (suggestions && suggestions.length > 0) {
              content += '<div class="suggestion-buttons">';
              suggestions.forEach((suggestion) => {
                content += `<button class="suggestion-btn" onclick="askQuestion('${suggestion}')">${suggestion}</button>`;
              });
              content += "</div>";
            }

            messageDiv.innerHTML = content;
          }

          messagesContainer.appendChild(messageDiv);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Tab switching function
        function switchTab(targetTab) {
          // Remove active class from all tabs and contents
          document
            .querySelectorAll(".tab-button")
            .forEach((tab) => tab.classList.remove("active"));
          document
            .querySelectorAll(".chat-tab")
            .forEach((content) => content.classList.remove("active"));

          // Add active class to target tab and content
          if (targetTab === "game") {
            gameTab.classList.add("active");
            gameChatTab.classList.add("active");
          } else if (targetTab === "lesson") {
            lessonTab.classList.add("active");
            lessonChatTab.classList.add("active");
          }
        }

        // Game Chat Knowledge Base
        const gameKnowledge = {
          rules: {
            keywords: ["rule", "cách chơi", "luật", "bắt đầu", "how to play"],
            answer: `🎮 **Cách chơi Policy Simulator:**
            
• **Vai trò**: Bạn là Thủ tướng quốc gia
• **Mục tiêu**: Cân bằng lợi ích quốc gia và các giai cấp xã hội
• **Thời gian**: 10 lượt chơi
• **Cách chơi**: Mỗi lượt chọn 1 chính sách để thực hiện

📊 **Theo dõi các chỉ số:**
- GDP, Thất nghiệp, Chỉ số Gini
- Uy tín chính phủ, Quân sự, Dịch vụ công
- Mức độ hài lòng của 5 nhóm xã hội`,
          },

          policies: {
            keywords: [
              "chính sách",
              "policy",
              "nên chọn",
              "tác động",
              "effect",
            ],
            answer: `🏛️ **8 Chính sách chính:**

1. **Thuế cao doanh nghiệp** - Tăng ngân sách, giảm hài lòng doanh nghiệp
2. **Tăng lương tối thiểu** - Công nhân vui, có thể giảm GDP ngắn hạn  
3. **Đầu tư giáo dục** - Lợi ích dài hạn, cải thiện nhân lực
4. **Tăng chi quốc phòng** - Tăng an ninh, giảm ngân sách khác
5. **Môi trường nghiêm ngặt** - Giảm ô nhiễm, ảnh hưởng sản xuất
6. **Hỗ trợ khởi nghiệp** - Thúc đẩy đổi mới, hỗ trợ doanh nghiệp nhỏ
7. **Cải cách y tế** - Nâng cao sức khỏe, tăng chi phí
8. **Đầu tư hạ tầng** - Thúc đẩy tăng trưởng, tạo việc làm`,
          },

          strategy: {
            keywords: [
              "chiến lược",
              "strategy",
              "gợi ý",
              "tip",
              "advice",
              "nên làm",
            ],
            answer: `💡 **Chiến lược chơi hiệu quả:**

🎯 **Nguyên tắc cân bằng:**
- Không ưu tiên 1 nhóm quá mức
- Chú ý đến tác động dài hạn
- Theo dõi các chỉ số thường xuyên

⚖️ **Cân bằng lợi ích:**
- Công nhân: Lương, phúc lợi
- Tầng lớp trung lưu: Ổn định, giáo dục  
- Nhà tư bản: Thuế thấp, tự do kinh doanh
- Thanh niên: Việc làm, môi trường
- Freelancer: Linh hoạt, đổi mới

⚠️ **Lưu ý:** Các quyết định có thể kích hoạt sự kiện xã hội bất ngờ!`,
          },

          indicators: {
            keywords: [
              "chỉ số",
              "indicator",
              "gdp",
              "thất nghiệp",
              "gini",
              "uy tín",
              "quân sự",
            ],
            answer: `📊 **Giải thích các chỉ số:**

💰 **GDP (0-100)**: Sức khỏe kinh tế, càng cao càng tốt
📈 **Thất nghiệp (0-100)**: Tỷ lệ thất nghiệp, càng thấp càng tốt  
⚖️ **Chỉ số Gini (0-1)**: Bất bình đẳng thu nhập, càng thấp càng tốt
🏛️ **Uy tín chính phủ (0-100)**: Tin tưởng dân chúng, quan trọng!
🛡️ **Quân sự (0-100)**: An ninh quốc gia
🏥 **Dịch vụ công (0-100)**: Chất lượng y tế, giáo dục, hạ tầng

${
  window.currentGameContext
    ? `
📈 **Tình hình hiện tại (Lượt ${window.currentGameContext.currentTurn}/${
        window.currentGameContext.maxTurns
      }):**
- GDP: ${window.currentGameContext.currentIndicators?.gdp || "N/A"}
- Thất nghiệp: ${
        window.currentGameContext.currentIndicators?.unemployment || "N/A"
      }
- Uy tín: ${window.currentGameContext.currentIndicators?.legitimacy || "N/A"}
`
    : ""
}`,
          },

          groups: {
            keywords: [
              "nhóm xã hội",
              "giai cấp",
              "công nhân",
              "tư bản",
              "trung lưu",
              "thanh niên",
              "freelancer",
            ],
            answer: `👥 **5 Nhóm xã hội:**

🔨 **Công nhân**: Lao động chân tay
- Quan tâm: Lương cao, phúc lợi, an toàn lao động
- Ủng hộ: Tăng lương tối thiểu, cải cách y tế

💼 **Tầng lớp trung lưu**: Thu nhập trung bình  
- Quan tâm: Ổn định kinh tế, giáo dục, y tế
- Ủng hộ: Đầu tư giáo dục, cải cách y tế

💰 **Nhà tư bản**: Chủ sở hữu doanh nghiệp
- Quan tâm: Thuế thấp, tự do kinh doanh  
- Phản đối: Thuế cao, quy định nghiêm ngặt

🌟 **Thanh niên**: Thế hệ trẻ
- Quan tâm: Việc làm, môi trường, công nghệ
- Ủng hộ: Hỗ trợ khởi nghiệp, bảo vệ môi trường

💻 **Freelancer**: Làm việc tự do
- Quan tâm: Linh hoạt, đổi mới sáng tạo
- Ủng hộ: Hỗ trợ khởi nghiệp, đầu tư công nghệ

${
  window.currentGameContext
    ? `
😊 **Mức độ hài lòng hiện tại:**
- Công nhân: ${window.currentGameContext.currentSocialGroups?.workers || "N/A"}
- Trung lưu: ${
        window.currentGameContext.currentSocialGroups?.middleClass || "N/A"
      }  
- Tư bản: ${window.currentGameContext.currentSocialGroups?.capitalists || "N/A"}
- Thanh niên: ${window.currentGameContext.currentSocialGroups?.youth || "N/A"}
- Freelancer: ${
        window.currentGameContext.currentSocialGroups?.freelancers || "N/A"
      }
`
    : ""
}`,
          },

          theory: {
            keywords: [
              "lý thuyết",
              "marx",
              "lenin",
              "mâu thuẫn",
              "giai cấp",
              "quốc gia",
            ],
            answer: `🤔 **Lý thuyết Marx-Lenin trong game:**

⚔️ **Mâu thuẫn cốt lõi:**
- Lợi ích **Quốc gia** vs Lợi ích **Giai cấp**
- Chính sách có thể có lợi cho đất nước nhưng gây thiệt hại cho một số giai cấp
- Hoặc ngược lại, có lợi cho giai cấp nhưng hại toàn quốc gia

🎯 **Mục tiêu game:** Tìm sự cân bằng tối ưu giữa:
- Tăng trưởng kinh tế tổng thể
- Công bằng xã hội giữa các tầng lớp
- Ổn định chính trị dài hạn

💡 **Bài học:** Không có quyết định nào hoàn hảo cho tất cả. Nghệ thuật cầm quyền là biết cân bằng!`,
          },
        };

        // Enhanced chatbot logic using GameAssistant
        function getBotResponse(userMessage) {
          // First try GameAssistant if available
          if (window.gameAssistant) {
            const assistantResponse = window.gameAssistant.analyze(userMessage);

            // If GameAssistant has a response, use it
            if (assistantResponse) {
              // Only add context indicator for specific game-related queries
              const needsContext =
                userMessage.toLowerCase().includes("tình hình") ||
                userMessage.toLowerCase().includes("phân tích") ||
                userMessage.toLowerCase().includes("hiện tại") ||
                userMessage.toLowerCase().includes("gợi ý");

              if (needsContext && window.currentGameContext) {
                const ctx = window.currentGameContext;

                // Kiểm tra chỉ số nguy hiểm theo đúng luật chơi
                const isCritical =
                  checkCriticalIndicators(ctx.currentIndicators) ||
                  Object.values(ctx.currentSocialGroups || {}).some(
                    (v) => v < 25
                  );

                if (isCritical) {
                  return `<span class="game-context-indicator warning">⚠️ Tình hình khẩn cấp</span><br>${assistantResponse}`;
                } else {
                  return `<span class="game-context-indicator">🎮 Lượt ${ctx.currentTurn}/${ctx.maxTurns}</span><br>${assistantResponse}`;
                }
              }

              return assistantResponse;
            }
          }

          // Fallback to original logic
          const message = userMessage.toLowerCase();

          // Check each knowledge category
          for (const [category, data] of Object.entries(gameKnowledge)) {
            if (data.keywords.some((keyword) => message.includes(keyword))) {
              return data.answer;
            }
          }

          // Context-aware responses
          if (window.currentGameContext) {
            if (
              message.includes("tình hình") ||
              message.includes("hiện tại") ||
              message.includes("current")
            ) {
              return `📊 **Tình hình game hiện tại (Lượt ${
                window.currentGameContext.currentTurn
              }/${window.currentGameContext.maxTurns}):**

💰 **Chỉ số quốc gia:**
- GDP: ${window.currentGameContext.currentIndicators?.gdp || "N/A"}
- Thất nghiệp: ${
                window.currentGameContext.currentIndicators?.unemployment ||
                "N/A"
              }  
- Uy tín chính phủ: ${
                window.currentGameContext.currentIndicators?.legitimacy || "N/A"
              }
- Quân sự: ${window.currentGameContext.currentIndicators?.military || "N/A"}

👥 **Mức độ hài lòng:**
- Công nhân: ${window.currentGameContext.currentSocialGroups?.workers || "N/A"}
- Trung lưu: ${
                window.currentGameContext.currentSocialGroups?.middleClass ||
                "N/A"
              }
- Tư bản: ${window.currentGameContext.currentSocialGroups?.capitalists || "N/A"}
- Thanh niên: ${window.currentGameContext.currentSocialGroups?.youth || "N/A"}

${
  window.currentGameContext.recentEvents?.length > 0
    ? `
🔔 **Sự kiện gần đây:**
${window.currentGameContext.recentEvents
  .slice(0, 2)
  .map((event) => `- ${event.title}`)
  .join("\n")}`
    : ""
}`;
            }
          }

          // Default responses with contextual suggestions
          const defaultResponses = [
            "🤖 Xin chào! Tôi là Game Assistant. Hỏi tôi về:\n• Rules & cách chơi\n• Chính sách & tác động\n• Chiến lược & tips\n• Chỉ số & nhóm xã hội\n• Lý thuyết Marx-Lenin",
            "💡 Hãy hỏi cụ thể hơn! Ví dụ:\n• 'Cách chơi game này?'\n• 'Chính sách nào tốt?'\n• 'Giải thích chỉ số GDP'\n• 'Tình hình hiện tại thế nào?'",
            "🎮 Tôi có thể giúp bạn hiểu rõ hơn về game Policy Simulator. Hãy hỏi về rules, chính sách, hoặc chiến lược!",
          ];

          const randomResponse =
            defaultResponses[
              Math.floor(Math.random() * defaultResponses.length)
            ];

          // Tạo gợi ý contextual thông minh
          let suggestions = [];

          if (window.gameAssistant && window.currentGameContext) {
            // Sử dụng GameAssistant để tạo gợi ý contextual
            suggestions = window.gameAssistant.generateContextualSuggestions();
          } else {
            // Gợi ý mặc định khi chưa có context
            suggestions = [
              "Cách chơi game này",
              "Giải thích các chỉ số",
              "Các nhóm xã hội là gì",
              "Chiến lược bắt đầu",
            ];
          }

          let finalResponse = randomResponse + "\n\n🔍 Bạn có thể hỏi:\n";
          suggestions.forEach((suggestion) => {
            finalResponse += `<button class="suggestion-btn" onclick="askQuestion('${suggestion}')">${suggestion}</button>\n`;
          });

          return finalResponse;
        }

        // Add message to chat
        function addMessage(message, isUser = false) {
          const messageDiv = document.createElement("div");
          messageDiv.className = `chat-message ${
            isUser ? "user-message" : "bot-message"
          }`;

          if (isUser) {
            messageDiv.innerHTML = `<div class="message-content">${message}</div>`;
          } else {
            // Process message to handle HTML content (like suggestion buttons)
            let processedMessage = message.replace(/\n/g, "<br>");

            messageDiv.innerHTML = `
              <div class="bot-avatar">🤖</div>
              <div class="message-content">${processedMessage}</div>
            `;
          }

          gameChatMessages.appendChild(messageDiv);

          // Force scroll to bottom with multiple methods
          setTimeout(() => {
            gameChatMessages.scrollTop = gameChatMessages.scrollHeight;
            gameChatMessages.scrollIntoView(false);
          }, 50);
        }

        // Send message function
        function sendGameMessage() {
          const message = gameChatInput.value.trim();
          if (!message) return;

          // Add user message
          addMessage(message, true);
          gameChatInput.value = "";

          // Get bot response
          setTimeout(() => {
            const response = getBotResponse(message);
            addMessage(response, false);
          }, 500);
        }

        // Unified Chat Event Listeners
        unifiedChatButton.addEventListener("click", function () {
          unifiedChatContainer.style.display = "block";
          unifiedChatButton.style.display = "none";

          // Add welcome message if first time opening game chat
          if (gameChatMessages.children.length === 0) {
            setTimeout(() => {
              const welcomeMessage = `🎮 Xin chào! Tôi là Game Assistant AI. Tôi có thể giúp bạn:

• Hiểu rules và cách chơi
• Phân tích chính sách và tác động  
• Đưa ra chiến lược và tips
• Giải thích các chỉ số game
• Hỗ trợ real-time khi chơi

🔍 Bạn có thể hỏi:
<button class="suggestion-btn" onclick="askQuestion('Cách chơi game này')">Cách chơi game này</button>
<button class="suggestion-btn" onclick="askQuestion('Giải thích các chỉ số')">Giải thích các chỉ số</button>
<button class="suggestion-btn" onclick="askQuestion('Chiến lược bắt đầu')">Chiến lược bắt đầu</button>

Hãy hỏi tôi bất cứ điều gì! 😊`;

              addMessage(welcomeMessage, false);
            }, 300);
          }
        });

        closeUnifiedChatButton.addEventListener("click", function () {
          unifiedChatContainer.style.display = "none";
          unifiedChatButton.style.display = "flex";
        });

        // Tab switching listeners
        gameTab.addEventListener("click", function () {
          switchTab("game");
        });

        lessonTab.addEventListener("click", function () {
          switchTab("lesson");
        });

        // Game chat functionality
        sendGameMessageButton.addEventListener("click", sendGameMessage);

        gameChatInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            sendGameMessage();
          }
        });

        // Send game context to lesson chatbot when it loads
        lessonChatIframe.addEventListener("load", function () {
          try {
            const gameContext = getGameContextForChatbot();
            console.log("Game context ready for lesson chatbot:", gameContext);
          } catch (error) {
            console.log("Game context not available yet");
          }
        });
      });
      // Function to get game context for chatbot
      function getGameContextForChatbot() {
        // Try to get game state from React component
        try {
          // Get current game context if available
          const currentContext = window.currentGameContext;

          // Basic game information for chatbot
          const gameInfo = {
            gameType: "Policy Simulator - Mô phỏng Chính sách",
            description:
              "Một trò chơi mô phỏng chính sách nơi người chơi đóng vai trò thủ tướng và đưa ra các quyết định chính sách ảnh hưởng đến đất nước.",

            // Current game state (if available)
            currentState: currentContext
              ? {
                  turn: `Lượt ${currentContext.currentTurn}/${currentContext.maxTurns}`,
                  indicators: {
                    GDP: currentContext.currentIndicators?.gdp || "N/A",
                    "Thất nghiệp":
                      currentContext.currentIndicators?.unemployment || "N/A",
                    "Chỉ số Gini":
                      currentContext.currentIndicators?.gini || "N/A",
                    "Uy tín chính phủ":
                      currentContext.currentIndicators?.legitimacy || "N/A",
                    "Quân sự":
                      currentContext.currentIndicators?.military || "N/A",
                    "Dịch vụ công":
                      currentContext.currentIndicators?.publicServices || "N/A",
                  },
                  socialGroups: {
                    "Công nhân":
                      currentContext.currentSocialGroups?.workers || "N/A",
                    "Tầng lớp trung lưu":
                      currentContext.currentSocialGroups?.middleClass || "N/A",
                    "Nhà tư bản":
                      currentContext.currentSocialGroups?.capitalists || "N/A",
                    "Thanh niên":
                      currentContext.currentSocialGroups?.youth || "N/A",
                    Freelancer:
                      currentContext.currentSocialGroups?.freelancers || "N/A",
                  },
                  selectedPolicy:
                    currentContext.selectedPolicy || "Chưa chọn chính sách",
                  recentEvents: currentContext.recentEvents || [],
                  gameStatus: currentContext.gameEnded
                    ? currentContext.gameWon
                      ? "Thắng"
                      : "Thua"
                    : "Đang chơi",
                }
              : null,

            instructions: [
              "🏛️ Bạn đang chơi vai trò một thủ tướng quốc gia",
              "📋 Mỗi lượt, bạn có thể chọn một chính sách để thực hiện",
              "📊 Các chính sách sẽ ảnh hưởng đến các chỉ số quốc gia như GDP, thất nghiệp, uy tín chính phủ",
              "⚖️ Mục tiêu là cân bằng các lợi ích và duy trì sự ổn định của đất nước",
              "⚠️ Chú ý đến các sự kiện xã hội có thể xảy ra do các quyết định của bạn",
              "🤔 Game khám phá mâu thuẫn giữa lợi ích quốc gia và lợi ích giai cấp",
            ],

            availablePolicies: currentContext?.currentPolicies || [
              {
                name: "Thuế cao cho doanh nghiệp",
                description:
                  "Tăng thuế doanh nghiệp để có thêm ngân sách nhà nước",
                effects: "Tăng ngân sách, giảm hài lòng của doanh nghiệp",
              },
              {
                name: "Tăng lương tối thiểu",
                description: "Nâng cao mức lương tối thiểu cho người lao động",
                effects: "Tăng hài lòng công nhân, có thể giảm GDP ngắn hạn",
              },
              {
                name: "Đầu tư vào giáo dục",
                description: "Tăng ngân sách cho hệ thống giáo dục",
                effects: "Cải thiện chất lượng nhân lực, lợi ích dài hạn",
              },
              {
                name: "Tăng chi tiêu quốc phòng",
                description: "Đầu tư mạnh vào an ninh quốc gia",
                effects: "Tăng an ninh, giảm ngân sách cho các lĩnh vực khác",
              },
              {
                name: "Chính sách môi trường nghiêm ngặt",
                description: "Siết chặt quy định bảo vệ môi trường",
                effects:
                  "Giảm ô nhiễm, có thể ảnh hưởng đến hoạt động sản xuất",
              },
              {
                name: "Hỗ trợ khởi nghiệp",
                description: "Chính sách khuyến khích khởi nghiệp và đổi mới",
                effects: "Thúc đẩy đổi mới, hỗ trợ doanh nghiệp nhỏ",
              },
              {
                name: "Cải cách y tế",
                description: "Cải thiện hệ thống y tế quốc gia",
                effects: "Nâng cao sức khỏe dân số, tăng chi phí ngân sách",
              },
              {
                name: "Đầu tư cơ sở hạ tầng",
                description: "Xây dựng và nâng cấp cơ sở hạ tầng",
                effects: "Thúc đẩy tăng trưởng kinh tế, tạo việc làm",
              },
            ],

            indicators: [
              {
                name: "GDP",
                description:
                  "Tổng sản phẩm quốc nội - thước đo sức khỏe kinh tế",
                range: "0-100",
              },
              {
                name: "Thất nghiệp",
                description: "Tỷ lệ thất nghiệp trong dân số",
                range: "0-100",
              },
              {
                name: "Chỉ số Gini",
                description: "Đo lường bất bình đẳng thu nhập",
                range: "0-1",
              },
              {
                name: "Uy tín chính phủ",
                description: "Mức độ tin tưởng của dân chúng",
                range: "0-100",
              },
              {
                name: "Quân sự",
                description: "Sức mạnh quốc phòng và an ninh",
                range: "0-100",
              },
              {
                name: "Dịch vụ công",
                description: "Chất lượng các dịch vụ công cộng",
                range: "0-100",
              },
            ],

            socialGroups: [
              {
                name: "Công nhân",
                description: "Tầng lớp lao động chân tay",
                interests: "Lương cao, phúc lợi, an toàn lao động",
              },
              {
                name: "Tầng lớp trung lưu",
                description: "Nhóm thu nhập trung bình",
                interests: "Ổn định kinh tế, giáo dục, y tế",
              },
              {
                name: "Nhà tư bản",
                description: "Chủ sở hữu các phương tiện sản xuất",
                interests: "Thuế thấp, tự do kinh doanh",
              },
              {
                name: "Thanh niên",
                description: "Thế hệ trẻ của đất nước",
                interests: "Việc làm, môi trường, công nghệ",
              },
              {
                name: "Freelancer",
                description: "Những người làm việc tự do",
                interests: "Linh hoạt, đổi mới, khởi nghiệp",
              },
            ],

            gameplayTips: [
              "💡 Cân bằng giữa tăng trưởng kinh tế và bảo vệ môi trường",
              "⏰ Chú ý đến tác động dài hạn của các chính sách",
              "📈 Theo dõi các chỉ số để đưa ra quyết định phù hợp",
              "🎯 Một số chính sách có thể có tác động tiêu cực ngắn hạn nhưng có lợi về lâu dài",
              "👥 Mỗi nhóm xã hội có lợi ích khác nhau, cần cân nhắc kỹ",
              "⚡ Các quyết định có thể dẫn đến các sự kiện xã hội bất ngờ",
              "🔄 Hãy luôn suy nghĩ về tác động domino của các chính sách",
            ],

            conflictTheory: [
              "🏛️ Game khám phá lý thuyết về mâu thuẫn giữa lợi ích quốc gia và giai cấp",
              "⚖️ Các chính sách có thể có lợi cho quốc gia nhưng bất lợi cho một số giai cấp",
              "🔄 Hoặc ngược lại, có lợi cho một giai cấp nhưng gây thiệt hại cho toàn quốc gia",
              "🎯 Mục tiêu là tìm ra sự cân bằng tối ưu giữa các lợi ích này",
              "📊 Theo dõi các chỉ số để nhận biết mâu thuẫn và điều chỉnh kịp thời",
            ],

            chatbotRole:
              "🤖 Tôi là trợ lý AI chuyên hỗ trợ người chơi Policy Simulator. Tôi có thể:\n" +
              "• Giải thích rules và cách chơi\n" +
              "• Đưa ra gợi ý chiến lược dựa trên tình hình hiện tại\n" +
              "• Phân tích tác động của các chính sách\n" +
              "• Giúp hiểu rõ hơn về lý thuyết chính trị trong game\n" +
              "• Tư vấn cách cân bằng các lợi ích khác nhau\n" +
              "• Dự đoán hậu quả có thể xảy ra\n\n" +
              "Hãy hỏi tôi bất cứ điều gì về game!",
          };

          return gameInfo;
        } catch (error) {
          // Fallback basic info
          return {
            gameType: "Policy Simulator",
            status: "Game context loading...",
            chatbotRole:
              "Tôi là trợ lý AI hỗ trợ game Policy Simulator. Hãy hỏi tôi về rules hoặc chiến lược!",
          };
        }
      }
    </script>
  </body>
</html>
